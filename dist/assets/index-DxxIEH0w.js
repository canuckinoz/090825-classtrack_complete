const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WeatherDashboard.improved-B47LYGBp.js","assets/ui-vendor-D6t9Fqz9.js","assets/react-vendor-DTDVRx5A.js","assets/data-vendor-CMp-lYVg.js","assets/index-BKQTLhv0.js","assets/index-BfXS8uzK.js","assets/api-8CS6GFDC.js","assets/utils-vendor-BoBknyFz.js","assets/index-C9pMmTaC.js","assets/index-BO4HEzZN.js","assets/index-DNeUrN3w.js","assets/index-BvxQFGc8.js","assets/index-aHyvsg0p.js","assets/index-BBtWB1JU.js","assets/index-DMcLTFlj.js","assets/index-CJ-UOd9S.js","assets/index-D9CqNw2i.js","assets/index-4THdT9Al.js","assets/index-CHdswrI9.js","assets/index-xBLB29KL.js","assets/NewReferral-CQVrDWKF.js","assets/referral-CxgCGxa_.js","assets/LPBSQueue-DzGR-EPD.js","assets/BSSQueue-ookQe8id.js"])))=>i.map(i=>d[i]);
import{r as u,a as Et,j as s,b as kt,R as N}from"./ui-vendor-D6t9Fqz9.js";import{a as Rt}from"./react-vendor-DTDVRx5A.js";import{c as _t,_ as A,a as Ot}from"./data-vendor-CMp-lYVg.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var se={},Te;function It(){if(Te)return se;Te=1;var e=Rt();return se.createRoot=e.createRoot,se.hydrateRoot=e.hydrateRoot,se}var At=It();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z.apply(this,arguments)}var W;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(W||(W={}));const Le="popstate";function Pt(e){e===void 0&&(e={});function t(n,a){let{pathname:i,search:l,hash:o}=n.location;return xe("",{pathname:i,search:l,hash:o},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:ie(a)}return Lt(t,r,null,e)}function F(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Tt(){return Math.random().toString(36).substr(2,8)}function Me(e,t){return{usr:e.state,key:e.key,idx:t}}function xe(e,t,r,n){return r===void 0&&(r=null),Z({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?de(t):t,{state:r,key:t&&t.key||n||Tt()})}function ie(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function de(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Lt(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:i=!1}=n,l=a.history,o=W.Pop,d=null,h=c();h==null&&(h=0,l.replaceState(Z({},l.state,{idx:h}),""));function c(){return(l.state||{idx:null}).idx}function y(){o=W.Pop;let x=c(),g=x==null?null:x-h;h=x,d&&d({action:o,location:m.location,delta:g})}function p(x,g){o=W.Push;let w=xe(m.location,x,g);h=c()+1;let f=Me(w,h),S=m.createHref(w);try{l.pushState(f,"",S)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;a.location.assign(S)}i&&d&&d({action:o,location:m.location,delta:1})}function j(x,g){o=W.Replace;let w=xe(m.location,x,g);h=c();let f=Me(w,h),S=m.createHref(w);l.replaceState(f,"",S),i&&d&&d({action:o,location:m.location,delta:0})}function v(x){let g=a.location.origin!=="null"?a.location.origin:a.location.href,w=typeof x=="string"?x:ie(x);return w=w.replace(/ $/,"%20"),F(g,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,g)}let m={get action(){return o},get location(){return e(a,l)},listen(x){if(d)throw new Error("A history only accepts one active listener");return a.addEventListener(Le,y),d=x,()=>{a.removeEventListener(Le,y),d=null}},createHref(x){return t(a,x)},createURL:v,encodeLocation(x){let g=v(x);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:p,replace:j,go(x){return l.go(x)}};return m}var De;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(De||(De={}));function st(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function Mt(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?de(e):e;return{pathname:r?r.startsWith("/")?r:Dt(r,t):t,search:Bt(n),hash:Ut(a)}}function Dt(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function pe(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ft(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function rt(e,t){let r=Ft(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function nt(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=de(e):(a=Z({},e),F(!a.pathname||!a.pathname.includes("?"),pe("?","pathname","search",a)),F(!a.pathname||!a.pathname.includes("#"),pe("#","pathname","hash",a)),F(!a.search||!a.search.includes("#"),pe("#","search","hash",a)));let i=e===""||a.pathname==="",l=i?"/":a.pathname,o;if(l==null)o=r;else{let y=t.length-1;if(!n&&l.startsWith("..")){let p=l.split("/");for(;p[0]==="..";)p.shift(),y-=1;a.pathname=p.join("/")}o=y>=0?t[y]:"/"}let d=Mt(a,o),h=l&&l!=="/"&&l.endsWith("/"),c=(i||l===".")&&r.endsWith("/");return!d.pathname.endsWith("/")&&(h||c)&&(d.pathname+="/"),d}const at=e=>e.join("/").replace(/\/\/+/g,"/"),Bt=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Ut=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,it=["post","put","patch","delete"];new Set(it);const zt=["get",...it];new Set(zt);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function oe(){return oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oe.apply(this,arguments)}const ot=u.createContext(null),Y=u.createContext(null),ke=u.createContext(null),ue=u.createContext({outlet:null,matches:[],isDataRoute:!1});function Qt(e,t){let{relative:r}=t===void 0?{}:t;he()||F(!1);let{basename:n,navigator:a}=u.useContext(Y),{hash:i,pathname:l,search:o}=ct(e,{relative:r}),d=l;return n!=="/"&&(d=l==="/"?n:at([n,l])),a.createHref({pathname:d,search:o,hash:i})}function he(){return u.useContext(ke)!=null}function Re(){return he()||F(!1),u.useContext(ke).location}function lt(e){u.useContext(Y).static||u.useLayoutEffect(e)}function qt(){let{isDataRoute:e}=u.useContext(ue);return e?Kt():$t()}function $t(){he()||F(!1);let e=u.useContext(ot),{basename:t,future:r,navigator:n}=u.useContext(Y),{matches:a}=u.useContext(ue),{pathname:i}=Re(),l=JSON.stringify(rt(a,r.v7_relativeSplatPath)),o=u.useRef(!1);return lt(()=>{o.current=!0}),u.useCallback(function(h,c){if(c===void 0&&(c={}),!o.current)return;if(typeof h=="number"){n.go(h);return}let y=nt(h,JSON.parse(l),i,c.relative==="path");e==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:at([t,y.pathname])),(c.replace?n.replace:n.push)(y,c.state,c)},[t,n,l,i,e])}function ct(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=u.useContext(Y),{matches:a}=u.useContext(ue),{pathname:i}=Re(),l=JSON.stringify(rt(a,n.v7_relativeSplatPath));return u.useMemo(()=>nt(e,JSON.parse(l),i,r==="path"),[e,l,i,r])}var dt=(function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e})(dt||{}),ut=(function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e})(ut||{});function Vt(e){let t=u.useContext(ot);return t||F(!1),t}function Wt(e){let t=u.useContext(ue);return t||F(!1),t}function Ht(e){let t=Wt(),r=t.matches[t.matches.length-1];return r.route.id||F(!1),r.route.id}function Kt(){let{router:e}=Vt(dt.UseNavigateStable),t=Ht(ut.UseNavigateStable),r=u.useRef(!1);return lt(()=>{r.current=!0}),u.useCallback(function(a,i){i===void 0&&(i={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,oe({fromRouteId:t},i)))},[e,t])}function Gt(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function Jt(e){let{basename:t="/",children:r=null,location:n,navigationType:a=W.Pop,navigator:i,static:l=!1,future:o}=e;he()&&F(!1);let d=t.replace(/^\/*/,"/"),h=u.useMemo(()=>({basename:d,navigator:i,static:l,future:oe({v7_relativeSplatPath:!1},o)}),[d,o,i,l]);typeof n=="string"&&(n=de(n));let{pathname:c="/",search:y="",hash:p="",state:j=null,key:v="default"}=n,m=u.useMemo(()=>{let x=st(c,d);return x==null?null:{location:{pathname:x,search:y,hash:p,state:j,key:v},navigationType:a}},[d,c,y,p,j,v,a]);return m==null?null:u.createElement(Y.Provider,{value:h},u.createElement(ke.Provider,{children:r,value:m}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ve(){return ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ve.apply(this,arguments)}function Yt(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,i;for(i=0;i<n.length;i++)a=n[i],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Xt(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Zt(e,t){return e.button===0&&(!t||t==="_self")&&!Xt(e)}const es=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ts="6";try{window.__reactRouterVersion=ts}catch{}const ss="startTransition",Fe=Et[ss];function rs(e){let{basename:t,children:r,future:n,window:a}=e,i=u.useRef();i.current==null&&(i.current=Pt({window:a,v5Compat:!0}));let l=i.current,[o,d]=u.useState({action:l.action,location:l.location}),{v7_startTransition:h}=n||{},c=u.useCallback(y=>{h&&Fe?Fe(()=>d(y)):d(y)},[d,h]);return u.useLayoutEffect(()=>l.listen(c),[l,c]),u.useEffect(()=>Gt(n),[n]),u.createElement(Jt,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:l,future:n})}const ns=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",as=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qr=u.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:i,replace:l,state:o,target:d,to:h,preventScrollReset:c,viewTransition:y}=t,p=Yt(t,es),{basename:j}=u.useContext(Y),v,m=!1;if(typeof h=="string"&&as.test(h)&&(v=h,ns))try{let f=new URL(window.location.href),S=h.startsWith("//")?new URL(f.protocol+h):new URL(h),C=st(S.pathname,j);S.origin===f.origin&&C!=null?h=C+S.search+S.hash:m=!0}catch{}let x=Qt(h,{relative:a}),g=is(h,{replace:l,state:o,target:d,preventScrollReset:c,relative:a,viewTransition:y});function w(f){n&&n(f),f.defaultPrevented||g(f)}return u.createElement("a",ve({},p,{href:v||x,onClick:m||i?n:w,ref:r,target:d}))});var Be;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Be||(Be={}));var Ue;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Ue||(Ue={}));function is(e,t){let{target:r,replace:n,state:a,preventScrollReset:i,relative:l,viewTransition:o}=t===void 0?{}:t,d=qt(),h=Re(),c=ct(e,{relative:l});return u.useCallback(y=>{if(Zt(y,r)){y.preventDefault();let p=n!==void 0?n:ie(h)===ie(c);d(e,{replace:p,state:a,preventScrollReset:i,relative:l,viewTransition:o})}},[h,d,c,n,a,r,e,i,l,o])}var X=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},os={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},ls=class{#e=os;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}},H=new ls;function cs(e){setTimeout(e,0)}var K=typeof window>"u"||"Deno"in globalThis;function L(){}function ds(e,t){return typeof e=="function"?e(t):e}function ye(e){return typeof e=="number"&&e>=0&&e!==1/0}function ht(e,t){return Math.max(e+(t||0)-Date.now(),0)}function $(e,t){return typeof e=="function"?e(t):e}function D(e,t){return typeof e=="function"?e(t):e}function ze(e,t){const{type:r="all",exact:n,fetchStatus:a,predicate:i,queryKey:l,stale:o}=e;if(l){if(n){if(t.queryHash!==_e(l,t.options))return!1}else if(!ee(t.queryKey,l))return!1}if(r!=="all"){const d=t.isActive();if(r==="active"&&!d||r==="inactive"&&d)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||a&&a!==t.state.fetchStatus||i&&!i(t))}function Qe(e,t){const{exact:r,status:n,predicate:a,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(r){if(G(t.options.mutationKey)!==G(i))return!1}else if(!ee(t.options.mutationKey,i))return!1}return!(n&&t.state.status!==n||a&&!a(t))}function _e(e,t){return(t?.queryKeyHashFn||G)(e)}function G(e){return JSON.stringify(e,(t,r)=>be(r)?Object.keys(r).sort().reduce((n,a)=>(n[a]=r[a],n),{}):r)}function ee(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>ee(e[r],t[r])):!1}var us=Object.prototype.hasOwnProperty;function mt(e,t){if(e===t)return e;const r=qe(e)&&qe(t);if(!r&&!(be(e)&&be(t)))return t;const a=(r?e:Object.keys(e)).length,i=r?t:Object.keys(t),l=i.length,o=r?new Array(l):{};let d=0;for(let h=0;h<l;h++){const c=r?h:i[h],y=e[c],p=t[c];if(y===p){o[c]=y,(r?h<a:us.call(e,c))&&d++;continue}if(y===null||p===null||typeof y!="object"||typeof p!="object"){o[c]=p;continue}const j=mt(y,p);o[c]=j,j===y&&d++}return a===l&&d===a?e:o}function le(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function qe(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function be(e){if(!$e(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!$e(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function $e(e){return Object.prototype.toString.call(e)==="[object Object]"}function hs(e){return new Promise(t=>{H.setTimeout(t,e)})}function we(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?mt(e,t):t}function ms(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function ps(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var Oe=Symbol();function pt(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===Oe?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function ft(e,t){return typeof e=="function"?e(...t):!!e}var fs=class extends X{#e;#t;#s;constructor(){super(),this.#s=e=>{if(!K&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#s=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Ie=new fs;function je(){let e,t;const r=new Promise((a,i)=>{e=a,t=i});r.status="pending",r.catch(()=>{});function n(a){Object.assign(r,a),delete r.resolve,delete r.reject}return r.resolve=a=>{n({status:"fulfilled",value:a}),e(a)},r.reject=a=>{n({status:"rejected",reason:a}),t(a)},r}var gs=cs;function xs(){let e=[],t=0,r=o=>{o()},n=o=>{o()},a=gs;const i=o=>{t?e.push(o):a(()=>{r(o)})},l=()=>{const o=e;e=[],o.length&&a(()=>{n(()=>{o.forEach(d=>{r(d)})})})};return{batch:o=>{let d;t++;try{d=o()}finally{t--,t||l()}return d},batchCalls:o=>(...d)=>{i(()=>{o(...d)})},schedule:i,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{n=o},setScheduler:o=>{a=o}}}var I=xs(),vs=class extends X{#e=!0;#t;#s;constructor(){super(),this.#s=e=>{if(!K&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#s=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(r=>{r(e)}))}isOnline(){return this.#e}},ce=new vs;function ys(e){return Math.min(1e3*2**e,3e4)}function gt(e){return(e??"online")==="online"?ce.isOnline():!0}var Se=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function xt(e){let t=!1,r=0,n;const a=je(),i=()=>a.status!=="pending",l=m=>{if(!i()){const x=new Se(m);p(x),e.onCancel?.(x)}},o=()=>{t=!0},d=()=>{t=!1},h=()=>Ie.isFocused()&&(e.networkMode==="always"||ce.isOnline())&&e.canRun(),c=()=>gt(e.networkMode)&&e.canRun(),y=m=>{i()||(n?.(),a.resolve(m))},p=m=>{i()||(n?.(),a.reject(m))},j=()=>new Promise(m=>{n=x=>{(i()||h())&&m(x)},e.onPause?.()}).then(()=>{n=void 0,i()||e.onContinue?.()}),v=()=>{if(i())return;let m;const x=r===0?e.initialPromise:void 0;try{m=x??e.fn()}catch(g){m=Promise.reject(g)}Promise.resolve(m).then(y).catch(g=>{if(i())return;const w=e.retry??(K?0:3),f=e.retryDelay??ys,S=typeof f=="function"?f(r,g):f,C=w===!0||typeof w=="number"&&r<w||typeof w=="function"&&w(r,g);if(t||!C){p(g);return}r++,e.onFail?.(r,g),hs(S).then(()=>h()?void 0:j()).then(()=>{t?p(g):v()})})};return{promise:a,status:()=>a.status,cancel:l,continue:()=>(n?.(),a),cancelRetry:o,continueRetry:d,canStart:c,start:()=>(c()?v():j().then(v),a)}}var vt=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ye(this.gcTime)&&(this.#e=H.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(K?1/0:300*1e3))}clearGcTimeout(){this.#e&&(H.clearTimeout(this.#e),this.#e=void 0)}},bs=class extends vt{#e;#t;#s;#r;#n;#i;#o;constructor(e){super(),this.#o=!1,this.#i=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#r=e.client,this.#s=this.#r.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Ve(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(e){if(this.options={...this.#i,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=Ve(this.options);t.data!==void 0&&(this.setData(t.data,{updatedAt:t.dataUpdatedAt,manual:!0}),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(e,t){const r=we(this.state.data,e,this.options);return this.#a({data:r,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),r}setState(e,t){this.#a({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#n?.promise;return this.#n?.cancel(e),t?t.then(L).catch(L):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>D(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Oe||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>$(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ht(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#n&&(this.#o?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(e&&this.setOptions(e),!this.options.queryFn){const o=this.observers.find(d=>d.options.queryFn);o&&this.setOptions(o.options)}const r=new AbortController,n=o=>{Object.defineProperty(o,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},a=()=>{const o=pt(this.options,t),h=(()=>{const c={client:this.#r,queryKey:this.queryKey,meta:this.meta};return n(c),c})();return this.#o=!1,this.options.persister?this.options.persister(o,h,this):o(h)},l=(()=>{const o={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:a};return n(o),o})();this.options.behavior?.onFetch(l,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==l.fetchOptions?.meta)&&this.#a({type:"fetch",meta:l.fetchOptions?.meta}),this.#n=xt({initialPromise:t?.initialPromise,fn:l.fetchFn,onCancel:o=>{o instanceof Se&&o.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(o,d)=>{this.#a({type:"failed",failureCount:o,error:d})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0});try{const o=await this.#n.start();if(o===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(o),this.#s.config.onSuccess?.(o,this),this.#s.config.onSettled?.(o,this.state.error,this),o}catch(o){if(o instanceof Se){if(o.silent)return this.#n.promise;if(o.revert){if(this.state.data===void 0)throw o;return this.state.data}}throw this.#a({type:"error",error:o}),this.#s.config.onError?.(o,this),this.#s.config.onSettled?.(this.state.data,o,this),o}finally{this.scheduleGc()}}#a(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...yt(r.data,this.options),fetchMeta:e.meta??null};case"success":const n={...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?n:void 0,n;case"error":const a=e.error;return{...r,error:a,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),I.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:e})})}};function yt(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:gt(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Ve(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var ws=class extends X{constructor(e,t){super(),this.options=t,this.#e=e,this.#a=null,this.#o=je(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#s=void 0;#r=void 0;#n;#i;#o;#a;#f;#h;#m;#c;#d;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),We(this.#t,this.options)?this.#u():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ne(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ne(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#w(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,r=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof D(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#j(),this.#t.setOptions(this.options),t._defaulted&&!le(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const n=this.hasListeners();n&&He(this.#t,r,this.options,t)&&this.#u(),this.updateResult(),n&&(this.#t!==r||D(this.options.enabled,this.#t)!==D(t.enabled,this.#t)||$(this.options.staleTime,this.#t)!==$(t.staleTime,this.#t))&&this.#g();const a=this.#x();n&&(this.#t!==r||D(this.options.enabled,this.#t)!==D(t.enabled,this.#t)||a!==this.#l)&&this.#v(a)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),r=this.createResult(t,e);return Ss(this,r)&&(this.#r=r,this.#i=this.options,this.#n=this.#t.state),r}getCurrentResult(){return this.#r}trackResult(e,t){return new Proxy(e,{get:(r,n)=>(this.trackProp(n),t?.(n),n==="promise"&&!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(r,n))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),r=this.#e.getQueryCache().build(this.#e,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#u(e){this.#j();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(L)),t}#g(){this.#b();const e=$(this.options.staleTime,this.#t);if(K||this.#r.isStale||!ye(e))return;const r=ht(this.#r.dataUpdatedAt,e)+1;this.#c=H.setTimeout(()=>{this.#r.isStale||this.updateResult()},r)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(e){this.#w(),this.#l=e,!(K||D(this.options.enabled,this.#t)===!1||!ye(this.#l)||this.#l===0)&&(this.#d=H.setInterval(()=>{(this.options.refetchIntervalInBackground||Ie.isFocused())&&this.#u()},this.#l))}#y(){this.#g(),this.#v(this.#x())}#b(){this.#c&&(H.clearTimeout(this.#c),this.#c=void 0)}#w(){this.#d&&(H.clearInterval(this.#d),this.#d=void 0)}createResult(e,t){const r=this.#t,n=this.options,a=this.#r,i=this.#n,l=this.#i,d=e!==r?e.state:this.#s,{state:h}=e;let c={...h},y=!1,p;if(t._optimisticResults){const P=this.hasListeners(),U=!P&&We(e,t),k=P&&He(e,r,t,n);(U||k)&&(c={...c,...yt(h.data,e.options)}),t._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:j,errorUpdatedAt:v,status:m}=c;p=c.data;let x=!1;if(t.placeholderData!==void 0&&p===void 0&&m==="pending"){let P;a?.isPlaceholderData&&t.placeholderData===l?.placeholderData?(P=a.data,x=!0):P=typeof t.placeholderData=="function"?t.placeholderData(this.#m?.state.data,this.#m):t.placeholderData,P!==void 0&&(m="success",p=we(a?.data,P,t),y=!0)}if(t.select&&p!==void 0&&!x)if(a&&p===i?.data&&t.select===this.#f)p=this.#h;else try{this.#f=t.select,p=t.select(p),p=we(a?.data,p,t),this.#h=p,this.#a=null}catch(P){this.#a=P}this.#a&&(j=this.#a,p=this.#h,v=Date.now(),m="error");const g=c.fetchStatus==="fetching",w=m==="pending",f=m==="error",S=w&&g,C=p!==void 0,E={status:m,fetchStatus:c.fetchStatus,isPending:w,isSuccess:m==="success",isError:f,isInitialLoading:S,isLoading:S,data:p,dataUpdatedAt:c.dataUpdatedAt,error:j,errorUpdatedAt:v,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>d.dataUpdateCount||c.errorUpdateCount>d.errorUpdateCount,isFetching:g,isRefetching:g&&!w,isLoadingError:f&&!C,isPaused:c.fetchStatus==="paused",isPlaceholderData:y,isRefetchError:f&&C,isStale:Ae(e,t),refetch:this.refetch,promise:this.#o,isEnabled:D(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const P=b=>{E.status==="error"?b.reject(E.error):E.data!==void 0&&b.resolve(E.data)},U=()=>{const b=this.#o=E.promise=je();P(b)},k=this.#o;switch(k.status){case"pending":e.queryHash===r.queryHash&&P(k);break;case"fulfilled":(E.status==="error"||E.data!==k.value)&&U();break;case"rejected":(E.status!=="error"||E.error!==k.reason)&&U();break}}return E}updateResult(){const e=this.#r,t=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#i=this.options,this.#n.data!==void 0&&(this.#m=this.#t),le(t,e))return;this.#r=t;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:n}=this.options,a=typeof n=="function"?n():n;if(a==="all"||!a&&!this.#p.size)return!0;const i=new Set(a??this.#p);return this.options.throwOnError&&i.add("error"),Object.keys(this.#r).some(l=>{const o=l;return this.#r[o]!==e[o]&&i.has(o)})};this.#S({listeners:r()})}#j(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#s=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#S(e){I.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function js(e,t){return D(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function We(e,t){return js(e,t)||e.state.data!==void 0&&Ne(e,t,t.refetchOnMount)}function Ne(e,t,r){if(D(t.enabled,e)!==!1&&$(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&Ae(e,t)}return!1}function He(e,t,r,n){return(e!==t||D(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&Ae(e,r)}function Ae(e,t){return D(t.enabled,e)!==!1&&e.isStaleByTime($(t.staleTime,e))}function Ss(e,t){return!le(e.getCurrentResult(),t)}function Ke(e){return{onFetch:(t,r)=>{const n=t.options,a=t.fetchOptions?.meta?.fetchMore?.direction,i=t.state.data?.pages||[],l=t.state.data?.pageParams||[];let o={pages:[],pageParams:[]},d=0;const h=async()=>{let c=!1;const y=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(t.signal.aborted?c=!0:t.signal.addEventListener("abort",()=>{c=!0}),t.signal)})},p=pt(t.options,t.fetchOptions),j=async(v,m,x)=>{if(c)return Promise.reject();if(m==null&&v.pages.length)return Promise.resolve(v);const w=(()=>{const B={client:t.client,queryKey:t.queryKey,pageParam:m,direction:x?"backward":"forward",meta:t.options.meta};return y(B),B})(),f=await p(w),{maxPages:S}=t.options,C=x?ps:ms;return{pages:C(v.pages,f,S),pageParams:C(v.pageParams,m,S)}};if(a&&i.length){const v=a==="backward",m=v?Ns:Ge,x={pages:i,pageParams:l},g=m(n,x);o=await j(x,g,v)}else{const v=e??i.length;do{const m=d===0?l[0]??n.initialPageParam:Ge(n,o);if(d>0&&m==null)break;o=await j(o,m),d++}while(d<v)}return o};t.options.persister?t.fetchFn=()=>t.options.persister?.(h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r):t.fetchFn=h}}}function Ge(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Ns(e,{pages:t,pageParams:r}){return t.length>0?e.getPreviousPageParam?.(t[0],t,r[0],r):void 0}var Cs=class extends vt{#e;#t;#s;constructor(e){super(),this.mutationId=e.mutationId,this.#t=e.mutationCache,this.#e=[],this.state=e.state||bt(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#e.includes(e)||(this.#e.push(e),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#e=this.#e.filter(t=>t!==e),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#r({type:"continue"})};this.#s=xt({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(a,i)=>{this.#r({type:"failed",failureCount:a,error:i})},onPause:()=>{this.#r({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const r=this.state.status==="pending",n=!this.#s.canStart();try{if(r)t();else{this.#r({type:"pending",variables:e,isPaused:n}),await this.#t.config.onMutate?.(e,this);const i=await this.options.onMutate?.(e);i!==this.state.context&&this.#r({type:"pending",context:i,variables:e,isPaused:n})}const a=await this.#s.start();return await this.#t.config.onSuccess?.(a,e,this.state.context,this),await this.options.onSuccess?.(a,e,this.state.context),await this.#t.config.onSettled?.(a,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(a,null,e,this.state.context),this.#r({type:"success",data:a}),a}catch(a){try{throw await this.#t.config.onError?.(a,e,this.state.context,this),await this.options.onError?.(a,e,this.state.context),await this.#t.config.onSettled?.(void 0,a,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,a,e,this.state.context),a}finally{this.#r({type:"error",error:a})}}finally{this.#t.runNext(this)}}#r(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),I.batch(()=>{this.#e.forEach(r=>{r.onMutationUpdate(e)}),this.#t.notify({mutation:this,type:"updated",action:e})})}};function bt(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Es=class extends X{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(e,t,r){const n=new Cs({mutationCache:this,mutationId:++this.#s,options:e.defaultMutationOptions(t),state:r});return this.add(n),n}add(e){this.#e.add(e);const t=re(e);if(typeof t=="string"){const r=this.#t.get(t);r?r.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=re(e);if(typeof t=="string"){const r=this.#t.get(t);if(r)if(r.length>1){const n=r.indexOf(e);n!==-1&&r.splice(n,1)}else r[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=re(e);if(typeof t=="string"){const n=this.#t.get(t)?.find(a=>a.state.status==="pending");return!n||n===e}else return!0}runNext(e){const t=re(e);return typeof t=="string"?this.#t.get(t)?.find(n=>n!==e&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){I.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(r=>Qe(t,r))}findAll(e={}){return this.getAll().filter(t=>Qe(e,t))}notify(e){I.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return I.batch(()=>Promise.all(e.map(t=>t.continue().catch(L))))}};function re(e){return e.options.scope?.id}var ks=class extends X{#e;#t=void 0;#s;#r;constructor(t,r){super(),this.#e=t,this.setOptions(r),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const r=this.options;this.options=this.#e.defaultMutationOptions(t),le(this.options,r)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),r?.mutationKey&&this.options.mutationKey&&G(r.mutationKey)!==G(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(t){this.#n(),this.#i(t)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#n(),this.#i()}mutate(t,r){return this.#r=r,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(t)}#n(){const t=this.#s?.state??bt();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#i(t){I.batch(()=>{if(this.#r&&this.hasListeners()){const r=this.#t.variables,n=this.#t.context;t?.type==="success"?(this.#r.onSuccess?.(t.data,r,n),this.#r.onSettled?.(t.data,null,r,n)):t?.type==="error"&&(this.#r.onError?.(t.error,r,n),this.#r.onSettled?.(void 0,t.error,r,n))}this.listeners.forEach(r=>{r(this.#t)})})}},Rs=class extends X{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,r){const n=t.queryKey,a=t.queryHash??_e(n,t);let i=this.get(a);return i||(i=new bs({client:e,queryKey:n,queryHash:a,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(n)}),this.add(i)),i}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){I.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>ze(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>ze(e,r)):t}notify(e){I.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){I.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){I.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},_s=class{#e;#t;#s;#r;#n;#i;#o;#a;constructor(e={}){this.#e=e.queryCache||new Rs,this.#t=e.mutationCache||new Es,this.#s=e.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#i=0}mount(){this.#i++,this.#i===1&&(this.#o=Ie.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=ce.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#i--,this.#i===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=this.#e.build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime($(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),i=this.#e.get(n.queryHash)?.state.data,l=ds(t,i);if(l!==void 0)return this.#e.build(this,n).setData(l,{...r,manual:!0})}setQueriesData(e,t,r){return I.batch(()=>this.#e.findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;I.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=this.#e;return I.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=I.batch(()=>this.#e.findAll(e).map(a=>a.cancel(r)));return Promise.all(n).then(L).catch(L)}invalidateQueries(e,t={}){return I.batch(()=>(this.#e.findAll(e).forEach(r=>{r.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=I.batch(()=>this.#e.findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let i=a.fetch(void 0,r);return r.throwOnError||(i=i.catch(L)),a.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(L)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=this.#e.build(this,t);return r.isStaleByTime($(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(L).catch(L)}fetchInfiniteQuery(e){return e.behavior=Ke(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(L).catch(L)}ensureInfiniteQueryData(e){return e.behavior=Ke(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return ce.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(e){this.#s=e}setQueryDefaults(e,t){this.#r.set(G(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#r.values()],r={};return t.forEach(n=>{ee(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){this.#n.set(G(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#n.values()],r={};return t.forEach(n=>{ee(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#s.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=_e(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Oe&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#s.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},wt=u.createContext(void 0),Pe=e=>{const t=u.useContext(wt);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Os=({client:e,children:t})=>(u.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),s.jsx(wt.Provider,{value:e,children:t})),jt=u.createContext(!1),Is=()=>u.useContext(jt);jt.Provider;function As(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Ps=u.createContext(As()),Ts=()=>u.useContext(Ps),Ls=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ms=e=>{u.useEffect(()=>{e.clearReset()},[e])},Ds=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(a&&e.data===void 0||ft(r,[e.error,n])),Fs=e=>{if(e.suspense){const r=a=>a==="static"?a:Math.max(a??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...a)=>r(n(...a)):r(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Bs=(e,t)=>e.isLoading&&e.isFetching&&!t,Us=(e,t)=>e?.suspense&&t.isPending,Je=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function zs(e,t,r){const n=Is(),a=Ts(),i=Pe(),l=i.defaultQueryOptions(e);i.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=n?"isRestoring":"optimistic",Fs(l),Ls(l,a),Ms(a);const o=!i.getQueryCache().get(l.queryHash),[d]=u.useState(()=>new t(i,l)),h=d.getOptimisticResult(l),c=!n&&e.subscribed!==!1;if(u.useSyncExternalStore(u.useCallback(y=>{const p=c?d.subscribe(I.batchCalls(y)):L;return d.updateResult(),p},[d,c]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),u.useEffect(()=>{d.setOptions(l)},[l,d]),Us(l,h))throw Je(l,d,a);if(Ds({result:h,errorResetBoundary:a,throwOnError:l.throwOnError,query:i.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw h.error;return i.getDefaultOptions().queries?._experimental_afterQuery?.(l,h),l.experimental_prefetchInRender&&!K&&Bs(h,n)&&(o?Je(l,d,a):i.getQueryCache().get(l.queryHash)?.promise)?.catch(L).finally(()=>{d.updateResult()}),l.notifyOnChangeProps?h:d.trackResult(h)}function Qs(e,t){return zs(e,ws)}function qs(e,t){const r=Pe(),[n]=u.useState(()=>new ks(r,e));u.useEffect(()=>{n.setOptions(e)},[n,e]);const a=u.useSyncExternalStore(u.useCallback(l=>n.subscribe(I.batchCalls(l)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),i=u.useCallback((l,o)=>{n.mutate(l,o).catch(L)},[n]);if(a.error&&ft(n.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:i,mutateAsync:a.mutate}}function $s({onClose:e}){const t=Js(),[r,n]=u.useState(),a=Pe(),l=(window.ClassTrack?.students||[]).filter(h=>h.class_id===t),{data:o}=Qs({queryKey:["oneTapSuggest",t,r],queryFn:async()=>{const h=`/api/one-tap/suggest?class_id=${encodeURIComponent(t)}${r?`&student_id=${encodeURIComponent(r)}`:""}`;return await(await fetch(h)).json()},enabled:!0}),d=qs({mutationFn:async h=>await(await fetch("/api/one-tap/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).json(),onSuccess:()=>{a.invalidateQueries({queryKey:["magic",t]}),St("Logged. Undo?",{action:{label:"Undo",onClick:()=>{}},duration:5e3}),e()}});return u.useEffect(()=>{const h=c=>{c.key==="Escape"&&e()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[e]),s.jsx("div",{className:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:e,"aria-modal":!0,role:"dialog",children:s.jsx("div",{className:"mx-auto mt-16 w-full max-w-2xl rounded-2xl bg-white p-4 shadow-xl",onClick:h=>h.stopPropagation(),children:r?s.jsx(Ws,{studentId:r,suggestions:o,onBack:()=>n(void 0),onPick:(h,c)=>{d.mutate({class_id:t,student_id:r,type:h,behaviour_tag:c})}}):s.jsx(Vs,{students:l,onPick:n})})})}function Vs({students:e,onPick:t}){const[r,n]=u.useState(""),a=u.useMemo(()=>e.filter(i=>String(i.name||"").toLowerCase().includes(r.toLowerCase())),[e,r]);return s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Choose student"}),s.jsx("input",{className:"mt-2 w-full rounded-md border px-3 py-2",autoFocus:!0,placeholder:"Search…",value:r,onChange:i=>n(i.target.value)}),s.jsx("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-3 gap-2",children:a.map(i=>s.jsxs("button",{onClick:()=>t(i.id),className:"rounded-xl border p-3 text-left hover:bg-black/5",children:[s.jsx("div",{className:"font-medium",children:i.name}),s.jsx("div",{className:"text-xs opacity-60",children:"Tap to select"})]},i.id))})]})}function Ws({studentId:e,suggestions:t,onBack:r,onPick:n}){const a=t?.topConcern||[],i=t?.topPositive||[],l=t?.pinned||{};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:r,className:"text-sm px-2 py-1 rounded-md border",children:"Back"}),s.jsx("div",{className:"text-sm opacity-70",children:"Double tap default to submit instantly"})]}),s.jsx("h3",{className:"mt-2 text-lg font-semibold",children:Gs(e)}),s.jsx(Ye,{title:"Behaviour of concern",items:a,defaultTag:l?.concern,onPick:o=>n("concern",o)}),s.jsx(Ye,{title:"Positive behaviour",items:i,defaultTag:l?.positive,onPick:o=>n("positive",o)}),s.jsx(Hs,{studentId:e,pinned:l})]})}function Ye({title:e,items:t,defaultTag:r,onPick:n}){return s.jsxs("section",{className:"mt-3",children:[s.jsx("div",{className:"text-sm font-medium",children:e}),s.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.map(a=>s.jsx("button",{onClick:()=>n(a),onDoubleClick:()=>n(a),className:`rounded-full px-3 py-2 border ${a===r?"border-blue-500 bg-blue-50":"border-black/10 bg-white hover:bg-black/5"}`,children:Ks(a)},a))})]})}function Hs({studentId:e,pinned:t}){const[r,n]=u.useState(t?.concern||""),[a,i]=u.useState(t?.positive||""),[l,o]=u.useState(!1);async function d(){o(!0),await fetch("/api/one-tap/pin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({student_id:e,concern:r||void 0,positive:a||void 0})}),o(!1),St("Saved defaults")}return s.jsxs("div",{className:"mt-4 rounded-xl border p-3",children:[s.jsx("div",{className:"text-sm font-medium",children:"Set this student’s default one concern and one positive"}),s.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[s.jsx("input",{value:r,onChange:h=>n(Xe(h.target.value)),placeholder:"e.g., task_switch",className:"rounded-md border px-3 py-2"}),s.jsx("input",{value:a,onChange:h=>i(Xe(h.target.value)),placeholder:"e.g., used_regulation",className:"rounded-md border px-3 py-2"})]}),s.jsx("button",{onClick:d,disabled:l,className:"mt-2 rounded-md bg-blue-600 text-white px-3 py-1",children:l?"Saving…":"Save defaults"}),s.jsx("div",{className:"text-xs opacity-60 mt-1",children:"Use lowercase tags with underscores. We render them nicely."})]})}function Ks(e){return(e||"").replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}function Xe(e){return(e||"").trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"")}function Gs(e){return window.ClassTrack?.students?.find(t=>String(t.id)===String(e))?.name||"Student"}function Js(){return window.ClassTrack?.currentClassId?.()||window.ClassTrack?.students?.[0]?.class_id||"CLASS-7A"}function St(e,t){window.toast?.(e,t)}function Ys(){const[e,t]=u.useState(!1),[r,n]=u.useState(null);return u.useEffect(()=>{n(document.body);const a=i=>{i.key.toLowerCase()==="b"&&t(l=>!l),i.key==="Escape"&&t(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),r?kt.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("button",{"aria-label":"One Tap Behaviour Log (shortcut: B)",onClick:()=>t(!0),className:"one-tap-fab",style:{position:"fixed",bottom:"calc(env(safe-area-inset-bottom, 0px) + 20px)",right:"calc(env(safe-area-inset-right, 0px) + 20px)",zIndex:9999,padding:"12px 18px",borderRadius:9999,color:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,.18)",background:"linear-gradient(135deg,#6AA9FF,#7ED0C1,#9C7BEA)"},children:"Log behaviour"}),e&&s.jsx($s,{onClose:()=>t(!1)})]}),r):null}const Ze={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:4000",VITE_APP_NAME:"ClassTrack",VITE_APP_VERSION:"1.0.0",VITE_DEV_AUTH_BYPASS:"false",VITE_DEV_EMAIL:"kevin@example.com",VITE_DEV_ROLE:"region_admin",VITE_DEV_SCHOOL_ID:"demo-school-001",VITE_ENABLE_DEBUG_MODE:"true",VITE_ENABLE_DEV_TOOLS:"true",VITE_SUPABASE_ANON_KEY:"your-anon-key-here",VITE_SUPABASE_URL:"https://your-project-id.supabase.co"},te=new Map,ne=e=>{const t=te.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([r,n])=>[r,n.getState()])):{}},Xs=(e,t,r)=>{if(e===void 0)return{type:"untracked",connection:t.connect(r)};const n=te.get(r.name);if(n)return{type:"tracked",store:e,...n};const a={connection:t.connect(r),stores:{}};return te.set(r.name,a),{type:"tracked",store:e,...a}},Zs=(e,t)=>{if(t===void 0)return;const r=te.get(e);r&&(delete r.stores[t],Object.keys(r.stores).length===0&&te.delete(e))},er=e=>{var t,r;if(!e)return;const n=e.split(`
`),a=n.findIndex(l=>l.includes("api.setState"));if(a<0)return;const i=((t=n[a+1])==null?void 0:t.trim())||"";return(r=/.+ (.+) .+/.exec(i))==null?void 0:r[1]},tr=(e,t={})=>(r,n,a)=>{const{enabled:i,anonymousActionType:l,store:o,...d}=t;let h;try{h=(i??(Ze?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return e(r,n,a);const{connection:c,...y}=Xs(o,h,d);let p=!0;a.setState=((m,x,g)=>{const w=r(m,x);if(!p)return w;const f=g===void 0?{type:l||er(new Error().stack)||"anonymous"}:typeof g=="string"?{type:g}:g;return o===void 0?(c?.send(f,n()),w):(c?.send({...f,type:`${o}/${f.type}`},{...ne(d.name),[o]:a.getState()}),w)}),a.devtools={cleanup:()=>{c&&typeof c.unsubscribe=="function"&&c.unsubscribe(),Zs(d.name,o)}};const j=(...m)=>{const x=p;p=!1,r(...m),p=x},v=e(a.setState,n,a);if(y.type==="untracked"?c?.init(v):(y.stores[y.store]=a,c?.init(Object.fromEntries(Object.entries(y.stores).map(([m,x])=>[m,m===y.store?v:x.getState()])))),a.dispatchFromDevtools&&typeof a.dispatch=="function"){let m=!1;const x=a.dispatch;a.dispatch=(...g)=>{(Ze?"production":void 0)!=="production"&&g[0].type==="__setState"&&!m&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),m=!0),x(...g)}}return c.subscribe(m=>{var x;switch(m.type){case"ACTION":if(typeof m.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return fe(m.payload,g=>{if(g.type==="__setState"){if(o===void 0){j(g.state);return}Object.keys(g.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const w=g.state[o];if(w==null)return;JSON.stringify(a.getState())!==JSON.stringify(w)&&j(w);return}a.dispatchFromDevtools&&typeof a.dispatch=="function"&&a.dispatch(g)});case"DISPATCH":switch(m.payload.type){case"RESET":return j(v),o===void 0?c?.init(a.getState()):c?.init(ne(d.name));case"COMMIT":if(o===void 0){c?.init(a.getState());return}return c?.init(ne(d.name));case"ROLLBACK":return fe(m.state,g=>{if(o===void 0){j(g),c?.init(a.getState());return}j(g[o]),c?.init(ne(d.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return fe(m.state,g=>{if(o===void 0){j(g);return}JSON.stringify(a.getState())!==JSON.stringify(g[o])&&j(g[o])});case"IMPORT_STATE":{const{nextLiftedState:g}=m.payload,w=(x=g.computedStates.slice(-1)[0])==null?void 0:x.state;if(!w)return;j(o===void 0?w:w[o]),c?.send(null,g);return}case"PAUSE_RECORDING":return p=!p}return}}),v},sr=tr,fe=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}r!==void 0&&t(r)},et={user:null,isAuthenticated:!1,role:"teacher",tenantId:null,schoolId:null,classId:null,lessons:[],students:[],classes:[],selectedClassId:null,behaviours:[],abcIncidents:[],engagementOptOuts:{},weatherData:null,forecastData:[],lastWeatherUpdate:null,loading:!1,error:null,currentView:"home",activeView:"ai",initialized:!1},me=_t()(sr((e,t)=>({...et,getLessons:()=>{const r=t();return Array.isArray(r.lessons)?r.lessons:[]},getStudents:()=>{const r=t();return Array.isArray(r.students)?r.students:[]},getSelectedClass:()=>{const r=t(),{selectedClassId:n,lessons:a}=r;return!n||!Array.isArray(a)?null:a.find(i=>i.id===n)||null},getForecastData:()=>{const r=t();return Array.isArray(r.forecastData)?r.forecastData:[]},setLessons:r=>{try{if(!Array.isArray(r)){console.warn("setLessons: Expected array, got:",typeof r);return}e({lessons:r})}catch(n){console.error("setLessons error:",n),e({error:n.message})}},setStudents:r=>{try{if(!Array.isArray(r)){console.warn("setStudents: Expected array, got:",typeof r);return}e({students:r})}catch(n){console.error("setStudents error:",n),e({error:n.message})}},login:(r=null)=>{try{const n=r||{id:"anonymous-user-001",name:"Demo Teacher",email:"demo@classtrack.com",role:"teacher",permissions:["read","write","export"],tenantId:"123e4567-e89b-12d3-a456-426614174000",schoolId:"987fcdeb-51a2-43d1-9f12-345678901234"};e({user:n,isAuthenticated:!0,role:n.role||"teacher",tenantId:n.tenantId,schoolId:n.schoolId,error:null}),console.log("User logged in:",n)}catch(n){console.error("Login error:",n),e({error:n.message})}},logout:()=>{try{e({user:null,isAuthenticated:!1,tenantId:null,schoolId:null,error:null}),console.log("User logged out")}catch(r){console.error("Logout error:",r),e({error:r.message})}},setUser:r=>{try{if(!r||typeof r!="object"){console.warn("setUser: Expected user object, got:",typeof r);return}e({user:r,isAuthenticated:!0,role:r.role||"teacher"})}catch(n){console.error("setUser error:",n),e({error:n.message})}},setRole:r=>{try{e({role:r})}catch(n){console.error("setRole error:",n)}},setUserRole:r=>{console.log(`[STATE UPDATE] User role changing to: ${r}`);try{const n={id:"dev-user-001",name:"Developer",email:"dev@classtrack.com",role:r,permissions:["read","write","export"],tenantId:"123e4567-e89b-12d3-a456-426614174000",schoolId:"987fcdeb-51a2-43d1-9f12-345678901234"};e(a=>({role:r,user:n,isAuthenticated:!0})),console.log(`[STATE UPDATE] Role successfully updated to: ${r}`,{newUser:n})}catch(n){console.error("setUserRole error:",n)}},setActiveView:r=>{try{if(!r||typeof r!="string"){console.warn("setActiveView: Expected string, got:",typeof r);return}e({activeView:r}),console.log("Active view changed to:",r)}catch(n){console.error("setActiveView error:",n),e({error:n.message})}},setClasses:r=>{try{if(!Array.isArray(r)){console.warn("setClasses: Expected array, got:",typeof r);return}e({classes:r})}catch(n){console.error("setClasses error:",n),e({error:n.message})}},setSelectedClassId:r=>{try{e({selectedClassId:r});const n=t();e({classId:r})}catch(n){console.error("setSelectedClassId error:",n),e({error:n.message})}},getClasses:()=>{const r=t();return Array.isArray(r.classes)?r.classes:[]},setWeatherData:r=>{try{e({weatherData:r})}catch(n){console.error("setWeatherData error:",n),e({error:n.message})}},setForecastData:r=>{try{if(!Array.isArray(r)){console.warn("setForecastData: Expected array, got:",typeof r);return}e({forecastData:r})}catch(n){console.error("setForecastData error:",n),e({error:n.message})}},setLoading:r=>{try{e({loading:!!r})}catch(n){console.error("setLoading error:",n)}},setError:r=>{try{e({error:r?String(r):null})}catch(n){console.error("setError error:",n)}},clearError:()=>{try{e({error:null})}catch(r){console.error("clearError error:",r)}},setView:r=>{try{e({currentView:r,activeView:r})}catch(n){console.error("setView error:",n),e({error:n.message})}},setSchool:r=>{try{e({schoolId:r}),console.log("School set:",r)}catch(n){console.error("setSchool error:",n),e({error:n.message})}},setTenant:r=>{try{e({tenantId:r}),console.log("Tenant set:",r)}catch(n){console.error("setTenant error:",n),e({error:n.message})}},setBehaviours:r=>{try{if(!Array.isArray(r)){console.warn("setBehaviours: Expected array, got:",typeof r);return}e({behaviours:r})}catch(n){console.error("setBehaviours error:",n),e({error:n.message})}},setABCIncidents:r=>{try{if(!Array.isArray(r)){console.warn("setABCIncidents: Expected array, got:",typeof r);return}e({abcIncidents:r})}catch(n){console.error("setABCIncidents error:",n),e({error:n.message})}},addABCIncident:r=>{try{e(n=>({abcIncidents:[...n.abcIncidents||[],r]}))}catch(n){console.error("addABCIncident error:",n),e({error:n.message})}},setTenantContext:(r,n=null,a=null)=>{try{e({tenantId:r,schoolId:n,classId:a}),console.log("Tenant context set:",{tenantId:r,schoolId:n,classId:a})}catch(i){console.error("setTenantContext error:",i),e({error:i.message})}},getTenantContext:()=>{const r=t();return{tenantId:r.tenantId,schoolId:r.schoolId,classId:r.classId}},setWeatherDataWithCache:r=>{try{e({weatherData:r,lastWeatherUpdate:new Date().toISOString()}),typeof window<"u"&&localStorage.setItem("classtrack_weather_cache",JSON.stringify({data:r,timestamp:new Date().toISOString()}))}catch(n){console.error("setWeatherDataWithCache error:",n),e({error:n.message})}},getWeatherFromCache:()=>{try{if(typeof window>"u")return null;const r=localStorage.getItem("classtrack_weather_cache");if(!r)return null;const{data:n,timestamp:a}=JSON.parse(r);return Date.now()-new Date(a).getTime()<3600*1e3?n:null}catch(r){return console.error("getWeatherFromCache error:",r),null}},initialize:()=>{try{e({initialized:!0,error:null}),console.log("Store initialized successfully")}catch(r){console.error("Store initialization error:",r),e({error:"Failed to initialize store"})}},reset:()=>{try{e({...et,initialized:!1}),console.log("Store reset to initial state")}catch(r){console.error("Store reset error:",r)}}}),{name:"classtrack-store"}));function _({children:e,allowedRoles:t}){const{user:r}=me(),n=r?.role||"guest";return console.log("[PROTECTED ROUTE] Checking access:",{currentUserRole:n,allowedRoles:t,canAccess:t.includes(n),user:r}),t.includes(n)?e:s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"You do not have the required permissions to view this page."}),!1]})}function Ce(){const{students:e,behaviours:t,schoolId:r,selectedClassId:n}=me();console.log("AI Dashboard - Store data:",{studentsCount:e?.length,behavioursCount:t?.length});const[a,i]=u.useState("emotions"),[l,o]=u.useState(null),[d,h]=u.useState(null),[c,y]=u.useState(null),[p,j]=u.useState(null),[v,m]=u.useState(!0),[x,g]=u.useState(null),w=e?.length>0?e:[{id:"demo-1",name:"Emma Johnson",grade:"4th",personality:"helpful"},{id:"demo-2",name:"Liam Chen",grade:"4th",personality:"creative"},{id:"demo-3",name:"Aisha Patel",grade:"4th",personality:"social"},{id:"demo-4",name:"Jordan Smith",grade:"4th",personality:"energetic"},{id:"demo-5",name:"Sofia Rodriguez",grade:"4th",personality:"thoughtful"}],f=t?.length>0?t:[{id:"b1",studentId:"demo-1",type:"positive",description:"Helped classmate with math problem",timestamp:new Date().toISOString()},{id:"b2",studentId:"demo-2",type:"positive",description:"Shared art supplies with classmates",timestamp:new Date().toISOString()},{id:"b3",studentId:"demo-3",type:"support_needed",description:"Had trouble waiting for turn",timestamp:new Date().toISOString()},{id:"b4",studentId:"demo-4",type:"positive",description:"Led group activity successfully",timestamp:new Date().toISOString()},{id:"b5",studentId:"demo-5",type:"positive",description:"Used kind words when upset",timestamp:new Date().toISOString()}],S=["Student showed frustration when the worksheet was too difficult","Great job helping your classmate with the math problem!","I'm feeling really excited about our science project","Student seemed worried about the upcoming test","That was amazing work on your presentation today!","I noticed you were having a hard time focusing during reading","You're doing such a great job staying organized this week"],C=async()=>{console.log("Starting emotion analysis...");try{const b=await fetch("/api/ai/analyze-emotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:S,classId:n||"demo-class"})});if(!b.ok)throw new Error("Failed to analyze emotions");const R=await b.json();console.log("Emotion analysis results:",R);const M=R.emotionPatterns.map((T,z)=>({originalNote:S[z]||"Sample behavior note",analysis:{emotion:T.emotion,confidence:T.confidence,intensity:T.confidence>.8?"high":T.confidence>.6?"medium":"low"},recommendations:{primary:`Address ${T.emotion} with appropriate intervention`,secondary:"Monitor student progress and provide targeted support"}}));o(M)}catch(b){console.error("Emotion analysis failed:",b),g("Failed to analyze emotions. Please try again."),o([])}},B=async()=>{try{const b=await fetch(`/api/ai/social-network?classId=${n||"demo-class"}`);if(!b.ok)throw new Error("Failed to analyze social network");const R=await b.json();console.log("Social network analysis results:",R);const M={report:{classOverview:{totalStudents:w.length,averageSocialHealth:Math.floor(R.analyzeInteractions.networkDensity*100),studentsNeedingSupport:R.insights.isolatedStudents.length,strongConnectors:R.insights.socialLeaders.length},studentDetails:w.slice(0,5).map((T,z)=>({studentId:T.id,studentName:T.name,socialRole:R.insights.socialLeaders.includes(T.name)?"leader":"peer",socialHealthScore:Math.floor(Math.random()*40)+60}))},relationships:R.relationships,insights:R.insights,recommendations:R.recommendations};h(M)}catch(b){console.error("Social network analysis failed:",b),g("Failed to analyze social network. Please try again."),h(null)}},E=async()=>{try{const R={name:`Positive Behavior Support Plan for ${w[0]?.name||"Alex"}`,startDate:new Date().toISOString(),progressTracking:{overallProgress:Math.floor(Math.random()*60)+20},phases:[{phase:"Assessment & Observation",timeframe:"1-2 weeks",status:"completed",success_criteria:"Identify behavior patterns and triggers",interventions:["Daily behavior tracking","Environmental assessment"],notes:["Student responds well to visual cues","Peak challenges occur during transitions"]},{phase:"Skill Building",timeframe:"3-4 weeks",status:"in_progress",success_criteria:"Student demonstrates alternative behaviors",interventions:["Coping strategies training","Social skills practice"],notes:["Progress noted in structured activities"]},{phase:"Reinforcement & Maintenance",timeframe:"2-3 weeks",status:"pending",success_criteria:"Consistent use of new skills",interventions:["Peer mentoring","Family engagement"],notes:[]}]};y(R)}catch(b){console.error("Intervention creation failed:",b),g("Failed to create intervention sequence. Please try again."),y(null)}},P=(b,R)=>{if(c){const M={...c,phases:c.phases.map(z=>z.phase===b?{...z,status:R?"completed":"needs_attention",notes:[...z.notes,`Updated: ${new Date().toLocaleDateString()}`]}:z)},T=M.phases.filter(z=>z.status==="completed").length;M.progressTracking.overallProgress=Math.floor(T/M.phases.length*100),y(M)}},U=async()=>{try{const b=await fetch("/api/ai/performance-report");if(!b.ok)throw new Error("Failed to get performance report");const R=await b.json();console.log("Performance stats:",R),j(R)}catch(b){console.error("Performance stats failed:",b),g("Failed to load performance statistics."),j(null)}};u.useEffect(()=>{(async()=>{console.log("AI Dashboard initializing..."),m(!0),g(null);try{await Promise.all([C(),E(),U()]),console.log("AI Dashboard initialization completed")}catch(R){console.error("AI Dashboard initialization error:",R),g("Failed to load AI dashboard data. Please refresh the page.")}finally{m(!1)}})()},[n]);const k=[{id:"emotions",label:"Emotion Recognition",icon:"🧠"},{id:"interventions",label:"Intervention Planning",icon:"📋"},{id:"social",label:"Social Network",icon:"🤝"},{id:"performance",label:"AI Performance",icon:"⚡"}];return console.log("AI Dashboard rendering:",{activeTab:a,emotionResults:l?.length,socialAnalysis:!!d,interventionSequence:!!c,performanceStats:!!p,loading:v}),v?s.jsx("div",{className:"min-h-screen bg-gray-50 p-6 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Loading AI Insights..."}),s.jsx("p",{className:"text-gray-500 mt-2",children:"Analyzing classroom data and generating reports"})]})}):x?s.jsx("div",{className:"min-h-screen bg-gray-50 p-6 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"AI Dashboard Error"}),s.jsx("p",{className:"text-gray-500 mb-4",children:x}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Refresh Page"})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[s.jsxs("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-4 mb-6",children:[s.jsx("h3",{className:"font-semibold text-blue-800",children:"AI Dashboard Debug Info"}),s.jsxs("div",{className:"text-sm text-blue-700 mt-2",children:[s.jsxs("p",{children:["Active Tab: ",a]}),s.jsxs("p",{children:["Emotion Results: ",l?.length||0]}),s.jsxs("p",{children:["Social Analysis: ",d?"Loaded":"Not loaded"]}),s.jsxs("p",{children:["Intervention Sequence: ",c?"Loaded":"Not loaded"]}),s.jsxs("p",{children:["Performance Stats: ",p?"Loaded":"Not loaded"]}),s.jsxs("p",{children:["Loading: ",v?"Yes":"No"]})]})]}),s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"text-4xl",children:"🤖"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"AI Dashboard"}),s.jsx("p",{className:"text-gray-600",children:"Explore ClassTrack's advanced AI capabilities"}),s.jsxs("div",{className:"text-sm mt-1",children:[s.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${e?.length>0?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:e?.length>0?"Live Data":"Demo Data"}),s.jsxs("span",{className:"text-gray-500 ml-2",children:[w.length," students • ",f.length," behaviors"]})]})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-2xl mb-2",children:"🧠"}),s.jsx("h3",{className:"font-semibold text-blue-900",children:"Emotion Recognition"}),s.jsx("p",{className:"text-sm text-blue-700",children:"Analyze emotional patterns in behavior notes"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-2xl mb-2",children:"📋"}),s.jsx("h3",{className:"font-semibold text-green-900",children:"Smart Interventions"}),s.jsx("p",{className:"text-sm text-green-700",children:"Automated multi-step intervention planning"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-2xl mb-2",children:"🤝"}),s.jsx("h3",{className:"font-semibold text-purple-900",children:"Social Networks"}),s.jsx("p",{className:"text-sm text-purple-700",children:"Map classroom relationship dynamics"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-2xl mb-2",children:"⚡"}),s.jsx("h3",{className:"font-semibold text-orange-900",children:"Performance"}),s.jsx("p",{className:"text-sm text-orange-700",children:"Optimized AI with intelligent caching"})]})]})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 mb-6",children:s.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(b=>s.jsxs("button",{onClick:()=>i(b.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${a===b.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[s.jsx("span",{children:b.icon}),b.label]},b.id))})}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a==="emotions"&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Emotion Recognition"}),s.jsx("p",{className:"text-gray-600",children:"AI-powered analysis of emotional patterns in behavior notes"})]}),s.jsx("button",{onClick:C,disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:v?"Analyzing...":"Re-analyze Emotions"})]}),s.jsx("div",{className:"grid gap-4",children:l.map((b,R)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"text-gray-800 mb-2",children:['"',b.originalNote,'"']}),s.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[s.jsxs("span",{className:`px-2 py-1 rounded-full ${b.analysis.intensity==="high"?"bg-red-100 text-red-800":b.analysis.intensity==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[b.analysis.emotion," (",Math.round(b.analysis.confidence*100),"%)"]}),s.jsxs("span",{className:"text-gray-500",children:["Intensity: ",b.analysis.intensity]})]})]})}),b.recommendations.primary&&s.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"Recommended Intervention"}),s.jsx("p",{className:"text-blue-800 text-sm",children:b.recommendations.primary})]})]},R))})]}),a==="interventions"&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Intervention Planning"}),s.jsx("p",{className:"text-gray-600",children:"Automated multi-step intervention sequences"})]}),s.jsx("button",{onClick:E,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Create Intervention Plan"})]}),c&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:c.name}),s.jsxs("p",{className:"text-green-800 text-sm",children:["Started: ",new Date(c.startDate).toLocaleDateString()]}),s.jsxs("p",{className:"text-green-800 text-sm",children:["Progress: ",Math.round(c.progressTracking.overallProgress),"%"]})]}),c.phases.map((b,R)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"font-semibold",children:[b.phase," Phase"]}),s.jsx("p",{className:"text-sm text-gray-600",children:b.timeframe})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b.status==="completed"?"bg-green-100 text-green-800":b.status==="active"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:b.status}),b.status==="active"&&s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>P(b.phase,!0),className:"px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700",children:"✓ Complete"}),s.jsx("button",{onClick:()=>P(b.phase,!1),className:"px-2 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"✗ Issue"})]})]})]}),s.jsx("p",{className:"text-sm text-gray-700 mb-2",children:b.success_criteria}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900 mb-1",children:"Interventions"}),s.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:b.interventions.map((M,T)=>s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),M]},T))})]}),b.notes.length>0&&s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900 mb-1",children:"Progress Notes"}),s.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:b.notes.slice(-3).map((M,T)=>s.jsxs("li",{className:"text-xs",children:[new Date(M.timestamp).toLocaleDateString(),": ",M.content]},T))})]})]})]},R))]})]}),a==="social"&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Social Network Analysis"}),s.jsx("p",{className:"text-gray-600",children:"Map classroom relationship dynamics and social health"})]}),s.jsx("button",{onClick:B,disabled:v,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:v?"Analyzing...":"Analyze Social Network"})]}),d&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg",children:[s.jsx("h3",{className:"text-xl font-semibold text-purple-900 mb-4",children:"Class Overview"}),s.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-700",children:d?.report?.classOverview?.averageSocialHealth||0}),s.jsx("div",{className:"text-sm text-purple-600",children:"Avg Social Health"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-700",children:d?.report?.classOverview?.totalStudents||0}),s.jsx("div",{className:"text-sm text-purple-600",children:"Total Students"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-700",children:d?.report?.classOverview?.studentsNeedingSupport||0}),s.jsx("div",{className:"text-sm text-purple-600",children:"Need Support"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-700",children:d?.report?.classOverview?.strongConnectors||0}),s.jsx("div",{className:"text-sm text-purple-600",children:"Strong Connectors"})]})]})]}),s.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Social Roles Distribution"}),s.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:d?.report?.classOverview?.socialRoles?Object.entries(d.report.classOverview.socialRoles).map(([b,R])=>s.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-700",children:R}),s.jsx("div",{className:"text-sm text-gray-600 capitalize",children:b.replace("_"," ")})]},b)):s.jsx("div",{className:"col-span-3 text-center text-gray-500",children:"No role data available"})})]}),s.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Student Social Health"}),s.jsx("div",{className:"space-y-3",children:d?.report?.studentDetails?.length>0?d.report.studentDetails.slice(0,5).map(b=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:b.studentName||"Unknown Student"}),s.jsx("div",{className:"text-sm text-gray-600 capitalize",children:(b.socialRole||"peer").replace("_"," ")})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[b.socialHealthScore||0,"%"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Social Health"})]})]},b.studentId)):s.jsx("div",{className:"text-center text-gray-500",children:"No student data available"})})]})]})]}),a==="performance"&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"AI Performance Metrics"}),s.jsx("p",{className:"text-gray-600",children:"Monitor AI system performance and optimization"})]}),s.jsx("button",{onClick:U,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:"Refresh Stats"})]}),p&&s.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Total Operations"}),s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.metrics?.totalOperations||0})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Average Response Time"}),s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.round(p.metrics?.averageResponseTime||0),"ms"]})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Cache Hit Rate"}),s.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round((p.metrics?.cacheHitRate||0)*100),"%"]})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Hit Rate"}),s.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round((p.metrics?.hitRate||0)*100),"%"]})]})]}),s.jsxs("div",{className:"mt-6 bg-yellow-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"🚀 Performance Optimizations Active"}),s.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("li",{children:"• Intelligent caching with LRU eviction"}),s.jsx("li",{children:"• Memoized expensive operations"}),s.jsx("li",{children:"• Batch processing for bulk operations"}),s.jsx("li",{children:"• Performance monitoring and metrics"}),s.jsx("li",{children:"• Automatic fallback to cached results"})]})]})]})]})]})]})}const rr=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));class tt extends N.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error(`[${this.props.featureName}] Error:`,t),console.error(`[${this.props.featureName}] Error Info:`,r),this.reportError(t,r)}reportError=(t,r)=>{const n={message:t.message,stack:t.stack,componentStack:r.componentStack,feature:this.props.featureName,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),url:window.location.href};console.error("Error Report:",n)};handleRetry=()=>{this.setState(t=>({hasError:!1,error:null,errorInfo:null,retryCount:t.retryCount+1}))};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null,retryCount:0})};render(){if(this.state.hasError){const{error:t}=this.state,{featureName:r,fallback:n}=this.props;return n?s.jsx(n,{error:t,featureName:r,onRetry:this.handleRetry,onReset:this.handleReset,retryCount:this.state.retryCount}):s.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-8",children:s.jsxs("div",{className:"max-w-md w-full bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[s.jsx("div",{className:"text-red-600 mb-4",children:s.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),s.jsxs("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:[r," Error"]}),s.jsxs("p",{className:"text-red-700 mb-4",children:["Something went wrong while loading ",r.toLowerCase(),".",this.state.retryCount>0&&` (Retry attempt: ${this.state.retryCount})`]}),s.jsxs("div",{className:"space-y-2",children:[this.state.retryCount<3&&s.jsx("button",{onClick:this.handleRetry,className:"w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"Try Again"}),s.jsx("button",{onClick:this.handleReset,className:"w-full bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors",children:"Reset Feature"})]}),!1]})})}return this.props.children}}class Vr extends N.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorId:null}}static getDerivedStateFromError(t){const r=`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return{hasError:!0,error:t,errorId:r}}componentDidCatch(t,r){console.error("App-level error:",t,r),this.reportError(t,r)}reportError=(t,r)=>{const n={errorId:this.state.errorId,message:t.message,stack:t.stack,componentStack:r.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:"anonymous",sessionId:"unknown"};console.error("App Error Report:",n)};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsxs("div",{className:"max-w-lg w-full bg-white border border-gray-200 rounded-lg shadow-lg p-8 text-center",children:[s.jsx("div",{className:"text-red-600 mb-6",children:s.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Please try refreshing the page."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:this.handleReload,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Reload Page"}),s.jsx("button",{onClick:()=>window.location.href="/",className:"w-full bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Go Home"})]}),!1]})}):this.props.children}}function O(e,t){const r="mfboeclk",n="avu01beu"+t.toString().padStart(1,"0");return`${e}-${t}-${r}-${n}`}function nr(){const e=["Emma","Liam","Olivia","Noah","Ava","William","Sophia","James","Isabella","Benjamin","Mia","Lucas","Charlotte","Henry","Amelia","Alexander","Harper","Michael","Evelyn","Daniel","Abigail","Matthew","Ella","Jackson","Elizabeth","Sebastian","Sofia","Ethan","Grace","Aiden","Chloe","Mason","Victoria","Logan","Lily","Jacob","Zoe"],t=["Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez","Hernandez","Lopez","Gonzalez","Wilson","Anderson","Thomas","Taylor","Moore","Jackson","Martin","Lee","Perez","Thompson","White","Harris","Sanchez","Clark","Ramirez","Lewis","Robinson","Walker","Young","Allen","King","Wright","Scott"],r=["leader","creative","thoughtful","social","analytical","artistic","energetic","organized","curious","helpful","independent","cooperative","confident","sensitive","adventurous","methodical","empathetic","focused"],n=["Kindergarten","1st","2nd","3rd","4th","5th"],a=[],i=[O("class-1A",1),O("class-1B",2),O("class-2A",3),O("class-2B",4),O("class-3A",5),O("class-3B",6),O("class-4A",7),O("class-4B",8),O("class-5A",9),O("class-5B",10),O("class-6A",11),O("class-6B",12)];for(let l=0;l<120;l++){const o=e[Math.floor(Math.random()*e.length)],d=t[Math.floor(Math.random()*t.length)],h=r[Math.floor(Math.random()*r.length)],c=n[Math.floor(Math.random()*n.length)],y=i[Math.floor(Math.random()*i.length)];let p;switch(h){case"leader":case"organized":case"helpful":p=.75+Math.random()*.2;break;case"creative":case"curious":case"social":p=.65+Math.random()*.2;break;case"energetic":case"independent":p=.5+Math.random()*.25;break;case"sensitive":case"focused":p=.6+Math.random()*.25;break;default:p=.55+Math.random()*.3}a.push({id:`student-${l+1}`,name:`${o} ${d}`,positiveRatio:Math.round(p*100)/100,engagementLevel:p>.75?"high":p>.6?"medium":"developing",totalBehaviours:Math.floor(Math.random()*50)+10,positiveBehaviours:0,lastPositiveLog:null,grade:c,classId:y,personality:h,avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${o}${d}`,interests:ar(h),supportNeeds:ir(h,p)})}return a}function ar(e){return{creative:["art","music","drama","writing"],artistic:["drawing","painting","crafts","design"],social:["team sports","group activities","friendships","cooperation"],energetic:["physical activities","sports","movement","outdoor play"],thoughtful:["reading","science","puzzles","research"],analytical:["math","logic games","coding","problem-solving"],leader:["organizing","teaching others","group projects","planning"],curious:["exploring","asking questions","experiments","learning new things"]}[e]||["learning","playing","creating"]}function ir(e,t){const r=[];return t<.6&&r.push("executive function support"),e==="energetic"&&t<.7&&r.push("self-regulation strategies"),e==="sensitive"&&r.push("emotional regulation support"),e==="independent"&&t<.65&&r.push("social skills development"),r.length>0?r:["general positive reinforcement"]}const q=nr();function or(e){const t=[],r=["Shared materials with classmates without being asked","Helped a peer who was struggling with their work","Used kind words when speaking to others","Showed patience during group work","Offered to help clean up the classroom","Encouraged a classmate who was feeling down","Worked cooperatively in a small group","Listened attentively during circle time","Used problem-solving skills independently","Showed enthusiasm for learning new concepts","Demonstrated leadership during group activities","Made a positive contribution to class discussion","Helped organize classroom materials","Showed creativity in approaching assignments","Demonstrated focus and concentration on tasks","Used self-control when feeling frustrated","Showed empathy towards classmates' feelings","Contributed ideas during brainstorming sessions","Helped resolve a conflict peacefully","Showed perseverance when work was challenging"],n=["Became frustrated when work was too difficult","Had trouble waiting for their turn","Struggled to stay focused during independent work","Got upset when things didn't go as planned","Had difficulty sharing materials with others","Showed signs of overwhelm during transitions","Needed reminders to stay on task","Expressed disappointment when making mistakes","Had trouble regulating emotions during conflicts","Struggled with following multi-step directions","Showed frustration during challenging activities","Needed support to calm down after excitement","Had difficulty accepting feedback","Struggled with transitions between activities","Showed signs of anxiety during assessments"],a=["Worked collaboratively with peers on group project","Invited others to join their play","Helped a classmate feel included","Used kind words during disagreements","Shared ideas respectfully in discussions","Showed appreciation for classmates' contributions","Supported a peer who was having difficulty","Used polite language when making requests","Helped mediate a disagreement between friends","Showed concern for classmates' feelings"],i=["Student seemed really excited about the science experiment today","I noticed the student was feeling frustrated when the math was challenging","The student appeared anxious about the upcoming presentation","Student showed determination despite finding the work difficult","I could see the student was disappointed when their idea wasn't chosen","The student demonstrated joy when they solved the problem independently","Student seemed overwhelmed by the amount of work to complete","The student showed enthusiasm for the art project","I noticed the student feeling proud of their accomplishments","The student appeared confused about the assignment instructions","Student showed empathy when comforting a classmate","The student seemed bored during the lecture portion","Student expressed happiness about the class pet","The student showed concern about an upcoming test","Student demonstrated patience while waiting for help"];let l=1;return e.forEach(o=>{const d=Math.floor(Math.random()*10)+5;for(let h=0;h<d;h++){const c=Math.floor(Math.random()*30),y=Math.floor(Math.random()*24),p=new Date(Date.now()-c*24*60*60*1e3-y*60*60*1e3),j=Math.random()<o.positiveRatio,v=Math.random()<.3;let m,x,g,w,f;j?(v?(m=a[Math.floor(Math.random()*a.length)],g=["social","cooperation","peer-relationship"]):(m=r[Math.floor(Math.random()*r.length)],g=["positive-behavior","independence","skill-demonstration"]),x="positive",w=Math.floor(Math.random()*2)+3):(m=n[Math.floor(Math.random()*n.length)],x="support_needed",g=["challenge","support-needed","growth-opportunity"],w=Math.floor(Math.random()*2)+1),Math.random()<.4&&(f=i[Math.floor(Math.random()*i.length)],m+=`. ${f}`),t.push({id:`behavior-${l++}`,studentId:o.id,type:x,description:m,timestamp:p.toISOString(),intensity:w,tags:g,emotionNote:f,location:["classroom","playground","library","cafeteria"][Math.floor(Math.random()*4)],activity:["reading","math","science","writing","art","music","pe","social-studies"][Math.floor(Math.random()*8)]})}}),t}or(q);O("class-4A",7),q.filter(e=>e.classId===O("class-4A",7)).length,O("class-4B",8),q.filter(e=>e.classId===O("class-4B",8)).length,O("class-5A",9),q.filter(e=>e.classId===O("class-5A",9)).length,O("class-5B",10),q.filter(e=>e.classId===O("class-5B",10)).length,O("class-3A",5),q.filter(e=>e.classId===O("class-3A",5)).length,O("class-3B",6),q.filter(e=>e.classId===O("class-3B",6)).length;new Date(Date.now()-10080*60*1e3).toISOString(),new Date(Date.now()-336*60*60*1e3).toISOString();Array.from({length:24},(e,t)=>({hour:t,riskLevel:Math.floor(Math.random()*5)+1,predictedEvents:Math.random()>.7?["transition","group_work","assessment"][Math.floor(Math.random()*3)]:[]}));new Date(Date.now()-7200*1e3).toISOString(),new Date(Date.now()-14400*1e3).toISOString(),new Date(Date.now()-360*60*1e3).toISOString();function Wr(e){const t=q.find(n=>n.id===e);if(!t)return null;const r=t.lastPositiveLog&&Date.now()-new Date(t.lastPositiveLog).getTime()<120*1e3;return{shouldShowShootingStar:r,starBrightness:t.positiveRatio,pulseEffect:r,trailColor:r?"#FFD700":"#FFC107"}}new Date().toISOString();let V=null;function lr(){return V||(V=document.createElement("div"),V.id="toast-container",V.className="fixed top-4 right-4 z-[9999] space-y-2",document.body.appendChild(V),V)}function cr(e,t="info"){const r=document.createElement("div"),n="px-4 py-3 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 ease-in-out",a={success:"bg-green-500 text-white",error:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-navy text-white"};return r.className=`${n} ${a[t]||a.info}`,r.textContent=e,r.style.transform="translateX(100%)",r.style.opacity="0",r}function Ee(e,t="info",r=3e3){const n=lr(),a=cr(e,t);return n.appendChild(a),requestAnimationFrame(()=>{a.style.transform="translateX(0)",a.style.opacity="1"}),setTimeout(()=>{a.style.transform="translateX(100%)",a.style.opacity="0",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)},r),a}const dr=({isOpen:e,onClose:t,onOpenEditModal:r,students:n=[],selectedClassId:a})=>{const[i,l]=u.useState(""),[o,d]=u.useState(""),[h,c]=u.useState(!1),[y,p]=u.useState(null),[j,v]=u.useState([]),[m,x]=u.useState(!1);u.useEffect(()=>{e&&(l(""),d(""),p(null))},[e]),u.useEffect(()=>{(async()=>{if(e){x(!0);try{const S=await fetch("/api/quick-log/behaviours");if(!S.ok)throw new Error("Failed to fetch behaviours");const C=await S.json();v(C.behaviours||[])}catch(S){console.error("Error fetching behaviours:",S),p("Failed to load behavior options. Please try again."),v([{id:"peer-support",label:"Peer Support",type:"positive"},{id:"on-task",label:"On Task",type:"positive"},{id:"needs-movement",label:"Needs Movement",type:"challenging"},{id:"disengagement",label:"Disengagement",type:"challenging"}])}finally{x(!1)}}})()},[e]);const g=n;u.useEffect(()=>{e&&console.log("QuickLogModal opened with:",{studentsCount:g.length,selectedClassId:a,studentsSample:g.slice(0,3).map(f=>({id:f.id,name:f.name,classId:f.classId}))})},[e,g,a]);const w=async f=>{if(f.preventDefault(),!i||!o){p("Please select both a student and a behavior.");return}c(!0),p(null);try{if((await fetch("/api/quick-log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:i,behaviourType:o,classId:a,timestamp:new Date().toISOString()})})).ok){console.log("Quick log submitted successfully");const C=g.find(B=>B.id===i);Ee(`Logged "${o}" for ${C?.name||"student"}`,"success"),t()}else throw new Error("Failed to submit quick log")}catch(S){console.error("Error submitting quick log:",S),p("Failed to submit quick log. Please try again.")}finally{c(!1)}};return e?s.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),s.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:s.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all max-w-md w-full",children:[s.jsx("div",{className:"bg-blue-600 px-6 py-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-medium text-white",children:"⚡ Quick Log"}),s.jsxs("button",{type:"button",className:"text-white hover:bg-blue-700 rounded-full p-1",onClick:t,children:[s.jsx("span",{className:"sr-only",children:"Close"}),s.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})]})}),s.jsx("div",{className:"px-6 py-4",children:s.jsxs("form",{onSubmit:w,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"student-select",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Student"}),s.jsxs("select",{id:"student-select",value:i,onChange:f=>l(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"Choose a student..."}),g.map(f=>s.jsx("option",{value:f.id,children:f.name},f.id))]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Behavior"}),r&&s.jsx("button",{type:"button",onClick:()=>{t(),r()},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center gap-1",title:"Edit behavior options",children:"✏️ Edit"})]}),m?s.jsxs("div",{className:"flex justify-center items-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading behaviors..."})]}):s.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto",children:j.map(f=>{const S=o===f.label,C=f.type==="positive";return s.jsxs("button",{type:"button",onClick:()=>d(f.label),className:`px-3 py-2 text-sm font-medium rounded-md border transition-colors text-left ${S?C?"bg-green-100 border-green-500 text-green-800":"bg-red-100 border-red-500 text-red-800":"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:[C?"👍":"⚠️"," ",f.label]},f.id)})}),j.length===0&&!m&&s.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:["No behavior options available.",r&&s.jsx("button",{type:"button",onClick:()=>{t(),r()},className:"text-blue-600 hover:text-blue-800 ml-1",children:"Add some behaviors"})]})]}),y&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-600",children:y})}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:h,children:"Cancel"}),s.jsx("button",{type:"submit",disabled:h||!i||!o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:h?s.jsxs("span",{className:"flex items-center",children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Log"})]})]})})]})})]}):null},ur=({isOpen:e,onClose:t,onSave:r})=>{const[n,a]=u.useState([]),[i,l]=u.useState(!1),[o,d]=u.useState(!1),[h,c]=u.useState(null),[y,p]=u.useState(""),[j,v]=u.useState("positive");u.useEffect(()=>{(async()=>{if(e){l(!0),c(null);try{const S=await fetch("/api/quick-log/behaviours");if(!S.ok)throw new Error("Failed to fetch behaviours");const C=await S.json();a(C.behaviours||[])}catch(S){console.error("Error fetching behaviours:",S),c("Failed to load behaviors. Please try again.")}finally{l(!1)}}})()},[e]),u.useEffect(()=>{e&&(p(""),v("positive"),c(null))},[e]);const m=()=>{const f=y.trim();if(!f){c("Please enter a behavior label");return}if(n.some(C=>C.label.toLowerCase()===f.toLowerCase())){c("This behavior already exists");return}const S={id:`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,label:f,type:j};a(C=>[...C,S]),p(""),c(null)},x=f=>{a(S=>S.filter(C=>C.id!==f))},g=async()=>{d(!0),c(null);try{const f=await fetch("/api/quick-log/behaviours",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({behaviours:n})});if(!f.ok)throw new Error("Failed to save behaviours");const S=await f.json();Ee("Behavior options updated successfully!","success"),r&&r(S.behaviours),t()}catch(f){console.error("Error saving behaviours:",f),c("Failed to save changes. Please try again."),Ee("Failed to save behavior changes","error")}finally{d(!1)}},w=f=>{f.key==="Enter"&&(f.preventDefault(),m())};return e?s.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),s.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:s.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all max-w-lg w-full",children:[s.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"✏️ Edit Behavior Options"}),s.jsxs("button",{type:"button",className:"text-gray-400 hover:text-gray-600 rounded-full p-1",onClick:t,children:[s.jsx("span",{className:"sr-only",children:"Close"}),s.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})]})}),s.jsxs("div",{className:"px-6 py-4",children:[i?s.jsxs("div",{className:"flex justify-center items-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading behaviors..."})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Add New Behavior"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"new-behaviour-label",className:"block text-xs font-medium text-gray-700 mb-1",children:"Behavior Label"}),s.jsx("input",{type:"text",id:"new-behaviour-label",value:y,onChange:f=>p(f.target.value),onKeyPress:w,placeholder:"e.g., Active Participation",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"new-behaviour-type",className:"block text-xs font-medium text-gray-700 mb-1",children:"Type"}),s.jsxs("select",{id:"new-behaviour-type",value:j,onChange:f=>v(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:[s.jsx("option",{value:"positive",children:"👍 Positive"}),s.jsx("option",{value:"challenging",children:"⚠️ Challenging"})]})]}),s.jsx("button",{type:"button",onClick:m,className:"w-full px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"+ Add Behavior"})]})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:["Current Behaviors (",n.length,")"]}),n.length===0?s.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:"No behaviors configured yet. Add some above!"}):s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:n.map(f=>s.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${f.type==="positive"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm",children:f.type==="positive"?"👍":"⚠️"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:f.label}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${f.type==="positive"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:f.type})]}),s.jsx("button",{type:"button",onClick:()=>x(f.id),className:"text-gray-400 hover:text-red-600 p-1",title:"Delete behavior",children:s.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]},f.id))})]})]}),h&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-600",children:h})})]}),s.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:o,children:"Cancel"}),s.jsx("button",{type:"button",onClick:g,disabled:o||i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:o?s.jsxs("span",{className:"flex items-center",children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Changes"})]})})]})})]}):null};function hr(){return s.jsx(_,{minRole:"school_admin",children:s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Admin Dashboard"}),s.jsxs("p",{className:"text-gray-600 mb-4",children:["This is an admin-only feature that requires ",s.jsx("strong",{children:"school_admin"})," role or higher."]}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"✅ Access Granted!"}),s.jsx("p",{className:"text-green-700",children:"You have successfully accessed this admin-level feature. In development mode, you can use the Dev Role Switcher at the bottom-left to test different permission levels."})]})]})})}function mr(){return s.jsx(_,{minRole:"school_admin",children:s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow max-w-2xl mx-auto",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4 text-green-800",children:"✅ Admin Access Granted!"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"You have successfully accessed this admin-level feature. This demonstrates that the role switching worked correctly."}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"🎉 Great Job!"}),s.jsx("p",{className:"text-green-700 text-sm",children:"You used the Dev Role Switcher to change your role and bypass the authentication barrier. This is exactly how the improved developer experience should work!"})]})]})})}function pr(){return s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow max-w-4xl mx-auto",children:[s.jsx("h2",{className:"text-3xl font-bold mb-6 text-green-800",children:"🔓 Permission System Test"}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"✅ Permission Changes Implemented"}),s.jsx("p",{className:"text-blue-700",children:"Teachers now have access to features that were previously restricted to admin roles. The system uses an array-based permission model instead of hierarchical ranking."})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(_,{minRole:"teacher",children:s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"👨‍🏫 Teacher Access"}),s.jsx("p",{className:"text-green-700 text-sm",children:'✅ You have access to teacher-level features (minRole="teacher")'})]})}),s.jsx(_,{minRole:"school_admin",children:s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"🏫 School Admin Access"}),s.jsxs("p",{className:"text-yellow-700 text-sm",children:['✅ You have access to school admin features (minRole="school_admin")',s.jsx("br",{}),s.jsx("span",{className:"text-xs text-gray-600",children:"Teachers can now access this with the updated permission system!"})]})]})})]}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"📋 Permission Matrix"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b",children:[s.jsx("th",{className:"text-left py-2",children:"Role"}),s.jsx("th",{className:"text-left py-2",children:"Can Access"}),s.jsx("th",{className:"text-left py-2",children:"Backend API"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"py-2 font-medium",children:"Teacher"}),s.jsx("td",{className:"py-2",children:"✅ teacher, school_admin, region_admin"}),s.jsx("td",{className:"py-2",children:"✅ CentralOffice endpoints"})]}),s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"py-2 font-medium",children:"School Admin"}),s.jsx("td",{className:"py-2",children:"✅ school_admin, region_admin"}),s.jsx("td",{className:"py-2",children:"✅ CentralOffice endpoints"})]}),s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"py-2 font-medium",children:"Region Admin"}),s.jsx("td",{className:"py-2",children:"✅ region_admin"}),s.jsx("td",{className:"py-2",children:"✅ CentralOffice endpoints"})]})]})]})})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:"🎯 Test the Changes"}),s.jsx("p",{className:"text-purple-700 mb-3",children:"Use the Dev Role Switcher (bottom-left) to test different permission levels:"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Teacher Role:"})," Should see all sections above"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"School Admin Role:"})," Should see School Admin and Teacher sections"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Region Admin Role:"})," Should see Region Admin section only"]})]})]})]})]})}const fr=({className:e=""})=>{const[t,r]=u.useState(!1),[n,a]=u.useState(null),{classes:i,selectedClassId:l,setClasses:o,setSelectedClassId:d,getTenantContext:h}=me(),c=async()=>{r(!0),a(null);try{const{tenantId:p,schoolId:j}=h(),v=new URLSearchParams;p&&v.append("tenantId",p),j&&v.append("schoolId",j);const m=`/api/classes${v.toString()?`?${v.toString()}`:""}`,x=await fetch(m,{method:"GET",headers:{"Content-Type":"application/json"}});if(!x.ok)throw new Error(`Failed to fetch classes: ${x.status} ${x.statusText}`);const g=await x.json();if(!Array.isArray(g))throw new Error("Invalid response format: expected array");const w=g.filter(f=>f&&typeof f.id=="string"&&typeof f.name=="string");w.length!==g.length&&console.warn(`ClassSelector: Filtered out ${g.length-w.length} invalid class objects`),o(w),!l&&w.length>0&&d(w[0].id)}catch(p){console.error("ClassSelector: Failed to fetch classes:",p),a(p.message)}finally{r(!1)}},y=p=>{const j=p.target.value;j&&j!==l&&(d(j),console.log("Class selected:",j))};return u.useEffect(()=>{c()},[]),t?s.jsx("div",{className:`class-selector loading ${e}`,children:s.jsx("select",{disabled:!0,className:"px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:s.jsx("option",{children:"Loading classes..."})})}):n?s.jsx("div",{className:`class-selector error ${e}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("select",{disabled:!0,className:"px-3 py-2 border border-red-300 rounded-md bg-red-50 text-red-700",children:s.jsx("option",{children:"Error loading classes"})}),s.jsx("button",{onClick:c,className:"px-2 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"Retry loading classes",children:"↻"})]})}):!i||i.length===0?s.jsx("div",{className:`class-selector empty ${e}`,children:s.jsx("select",{disabled:!0,className:"px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500",children:s.jsx("option",{children:"No classes available"})})}):s.jsx("div",{className:`class-selector ${e}`,children:s.jsxs("select",{value:l||"",onChange:y,className:"px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors","aria-label":"Select a class",children:[!l&&s.jsx("option",{value:"",disabled:!0,children:"Select a class..."}),i.map(p=>s.jsx("option",{value:p.id,children:p.name},p.id))]})})},Nt=N.memo(({feature:e,summary:t,summaryLoading:r,onClick:n})=>{const a=u.useCallback(()=>{if(r)return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-gray-300 mr-2"}),"Loading summary..."]})});if(!t)return null;switch(e.id){case"weather":return s.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsx("span",{className:"font-medium text-gray-600",children:"Risk Level"}),s.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.riskLevel<=2?"bg-green-100 text-green-800":t.riskLevel<=4?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[t.riskLevel,"/5"]})]}),s.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:["Weather: ",t.metaphor]})]});case"analytics":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.totalLogsThisWeek," logs this week"]}),s.jsxs("span",{className:"ml-2 text-green-600",children:["(",t.positiveRatio,"% positive)"]})]})});case"constellation":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:["Brightest: ",t.brightestStarName]}),s.jsxs("span",{className:"ml-2",children:[t.shootingStarCount," shooting stars"]})]})});case"dataStories":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.newStoriesThisWeek," new stories"]}),s.jsxs("span",{className:"ml-2",children:[t.positivePatterns," positive patterns"]})]})});case"ai":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.emotionInsights," emotion insights"]}),s.jsxs("span",{className:"ml-2",children:[t.interventionPlans," intervention plans"]})]})});case"strengthReports":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.studentsAnalyzed," students analyzed"]}),s.jsxs("span",{className:"ml-2",children:["Top: ",t.topStrength]})]})});case"seatMap":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.optimizedSeats," optimized seats"]}),s.jsxs("span",{className:"ml-2",children:[t.behaviorClusters," behavior clusters"]})]})});case"ocean":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.wavesToday," waves today"]}),s.jsxs("span",{className:"ml-2",children:[t.calmOceanPercentage,"% calm"]})]})});case"quicklog":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.logsToday," logs today"]}),s.jsxs("span",{className:"ml-2",children:[t.avgLogTime,"s avg time"]})]})});case"abc":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("span",{className:"font-medium",children:[t.incidentsAnalyzed," incidents analyzed"]}),s.jsxs("span",{className:"ml-2",children:[t.patternsFound," patterns found"]})]})});case"behaviourLog":return s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Quick & Easy"}),s.jsx("span",{className:"ml-2 text-green-600",children:"Ready to log"})]})});default:return null}},[t,r]);return s.jsxs("div",{className:`bg-${e.color}-50 p-4 rounded-lg cursor-pointer hover:bg-${e.color}-100 transition-colors duration-200 hover:shadow-md`,onClick:()=>n(e.id),role:"button",tabIndex:0,onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),n(e.id))},children:[s.jsx("div",{className:"text-2xl mb-2",children:e.icon}),s.jsx("h3",{className:`font-semibold text-${e.color}-900`,children:e.title}),s.jsx("p",{className:`text-sm text-${e.color}-700`,children:e.description}),a()]})});Nt.displayName="FeatureCard";const gr=N.lazy(()=>A(()=>import("./WeatherDashboard.improved-B47LYGBp.js"),__vite__mapDeps([0,1,2,3])).then(e=>({default:e.WeatherDashboard}))),xr=N.lazy(()=>A(()=>import("./index-BKQTLhv0.js"),__vite__mapDeps([4,1,2,3]))),vr=N.lazy(()=>A(()=>import("./index-BfXS8uzK.js"),__vite__mapDeps([5,1,2,6,7,3]))),yr=N.lazy(()=>A(()=>import("./index-C9pMmTaC.js"),__vite__mapDeps([8,1,2,3]))),br=N.lazy(()=>A(()=>import("./index-BO4HEzZN.js"),__vite__mapDeps([9,1,2]))),wr=N.lazy(()=>A(()=>import("./index-DNeUrN3w.js"),__vite__mapDeps([10,1,2,3]))),jr=N.lazy(()=>A(()=>import("./index-BvxQFGc8.js"),__vite__mapDeps([11,1,2,3]))),Sr=N.lazy(()=>A(()=>import("./index-aHyvsg0p.js"),__vite__mapDeps([12,1,2,6,7,3]))),Nr=N.lazy(()=>A(()=>import("./index-BBtWB1JU.js"),__vite__mapDeps([13,1,2])));N.lazy(()=>A(()=>import("./index-DMcLTFlj.js"),__vite__mapDeps([14,1,2])));const Cr=N.lazy(()=>A(()=>import("./index-CJ-UOd9S.js"),__vite__mapDeps([15,1,2,3]))),Er=N.lazy(()=>A(()=>import("./index-D9CqNw2i.js"),__vite__mapDeps([16,1,2,3]))),kr=N.lazy(()=>A(()=>import("./index-4THdT9Al.js"),__vite__mapDeps([17,1,2,3]))),Rr=N.lazy(()=>A(()=>import("./index-CHdswrI9.js"),__vite__mapDeps([18,1,2,3]))),_r=N.lazy(()=>A(()=>import("./index-xBLB29KL.js"),__vite__mapDeps([19,1,2,3]))),Or=N.lazy(()=>A(()=>import("./NewReferral-CQVrDWKF.js"),__vite__mapDeps([20,1,2,21,3])));N.lazy(()=>A(()=>import("./LPBSQueue-DzGR-EPD.js"),__vite__mapDeps([22,1,2,21,3])));N.lazy(()=>A(()=>import("./BSSQueue-ookQe8id.js"),__vite__mapDeps([23,1,2,21,3])));function Ir(){console.log("🎯 App component loading...");const{currentView:e,setView:t,setStudents:r,setBehaviours:n,setABCIncidents:a,students:i,behaviours:l,abcIncidents:o,setSchool:d,setTenant:h,selectedClassId:c,setClasses:y,classes:p}=me(),[j,v]=u.useState(!1),[m,x]=u.useState(null),[g,w]=u.useState(!0),[f,S]=u.useState(!1),[C,B]=u.useState(!1);console.log("📱 Current view:",e);const E=u.useCallback(k=>{console.log("🔄 Changing view to:",k),k==="ai"&&!Ce&&A(()=>Promise.resolve().then(()=>rr),void 0),t(k),console.log("✅ View change requested")},[t]);N.useEffect(()=>{d("550e8400-e29b-41d4-a716-446655440001"),h("550e8400-e29b-41d4-a716-446655440000")},[y,r,n,a]),N.useEffect(()=>{c&&(console.log("📊 Fetching home summary for class:",c),w(!0),fetch(`/api/home-summary/${c}`).then(k=>k.json()).then(k=>{console.log("✅ Home summary data loaded:",k),x(k),w(!1)}).catch(k=>{console.error("❌ Error fetching home summary:",k),w(!1)}))},[c]);const P=()=>{t("home"),console.log("Switched to Home")},U=u.useMemo(()=>[{id:"behaviourLog",title:"Behaviour Log",icon:"📝",description:"Quick and easy behavior logging",color:"blue"},{id:"abc",title:"ABC Tracker",icon:"📊",description:"Antecedent-Behavior-Consequence analysis",color:"green"},{id:"ai",title:"AI Dashboard",icon:"🧠",description:"Advanced emotion recognition and intervention planning",color:"purple"},{id:"constellation",title:"Constellation",icon:"⭐",description:"Achievement celebrations and progress",color:"red"},{id:"weather",title:"Weather",icon:"⚡",description:"Predictive behavior forecasting",color:"yellow"},{id:"analytics",title:"Analytics",icon:"📈",description:"Reports and data visualization",color:"indigo"},{id:"dataStories",title:"Data Stories",icon:"📖",description:"Positive, narrative progress reports",color:"purple"},{id:"strategies",title:"Strategies",icon:"📚",description:"Evidence-based intervention strategies",color:"pink"},{id:"quicklog",title:"Quick Log",icon:"⚡",description:"Rapid behavior documentation",color:"teal"},{id:"reports",title:"Reports",icon:"📋",description:"Student progress reports",color:"amber"},{id:"seatMap",title:"Seat Map",icon:"🪑",description:"Classroom seating arrangements",color:"cyan"},{id:"strengthReports",title:"Strength Reports",icon:"🌟",description:"Positive, strength-based student reports",color:"yellow"},{id:"documents",title:"AI Documents",icon:"📄",description:"AI-powered behavior support and safety plans",color:"emerald"},{id:"referrals",title:"Referrals",icon:"🤝",description:"Behaviour support referral system",color:"blue"},{id:"settings",title:"Settings",icon:"⚙️",description:"Application preferences and configuration",color:"gray"},{id:"ocean",title:"Ocean",icon:"🌊",description:"Ocean-themed behavior tracking",color:"lime"}],[]);return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("header",{className:"bg-blue-600 text-white p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"🎯 ClassTrack"}),e!=="home"&&s.jsx("button",{onClick:P,className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-400 text-sm",children:"← Home"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(fr,{}),s.jsx("button",{onClick:()=>E("behaviourLog"),className:`px-3 py-1 rounded text-sm ${e==="behaviourLog"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"📝 Log"}),s.jsx("button",{onClick:()=>E("abc"),className:`px-3 py-1 rounded text-sm ${e==="abc"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"📊"}),s.jsx("button",{onClick:()=>E("weather"),className:`px-3 py-1 rounded text-sm ${e==="weather"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"🌤️ Weather"}),s.jsx("button",{onClick:()=>E("constellation"),className:`px-3 py-1 rounded text-sm ${e==="constellation"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"⭐ Stars"}),s.jsx("button",{onClick:()=>E("analytics"),className:`px-3 py-1 rounded text-sm ${e==="analytics"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"📈 Analytics"}),s.jsx("button",{onClick:()=>E("quicklog"),className:`px-3 py-1 rounded text-sm ${e==="quicklog"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"⚡ Quick Log"}),s.jsx("button",{onClick:()=>E("reports"),className:`px-3 py-1 rounded text-sm ${e==="reports"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"📋 Reports"}),s.jsx("button",{onClick:()=>E("referrals"),className:`px-3 py-1 rounded text-sm ${e==="referrals"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"🤝 Referrals"}),s.jsx("button",{onClick:()=>E("strategies"),className:`px-3 py-1 rounded text-sm ${e==="strategies"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"📚 Strategies"}),s.jsx("button",{onClick:()=>E("ocean"),className:`px-3 py-1 rounded text-sm ${e==="ocean"?"bg-white text-blue-600":"hover:bg-blue-500"}`,children:"🌊"}),s.jsx("button",{onClick:()=>E("ai"),className:`px-4 py-2 rounded-lg text-sm font-semibold ${e==="ai"?"bg-white text-blue-600":"bg-blue-700 hover:bg-blue-800"}`,children:"🤖 AI Dashboard"}),!1,!1]})]})}),s.jsx("main",{className:"p-6",children:(()=>{switch(console.log("🎨 Rendering view:",e),e){case"ai":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(tt,{featureName:"AI Dashboard",children:s.jsx(Ce,{})})});case"admin-test":return s.jsx(_,{allowedRoles:["school_admin","region_admin","CentralOffice"],children:s.jsx(hr,{})});case"dev-demo":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(mr,{})});case"permission-test":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(pr,{})});case"behaviourLog":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📝 Loading Behaviour Log..."}),children:s.jsx(vr,{})})});case"abc":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📊 Loading ABC Tracker..."}),children:s.jsx(yr,{})})});case"weather":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"🌤️ Loading Weather..."}),children:s.jsx(gr,{})})});case"constellation":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"⭐ Loading Constellation..."}),children:s.jsx(xr,{})})});case"analytics":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(tt,{featureName:"Analytics Dashboard",children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📈 Loading Analytics..."}),children:s.jsx(br,{})})})});case"dataStories":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📖 Loading Data Stories..."}),children:s.jsx(wr,{})})});case"quicklog":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-xl text-gray-600",children:"⚡ Loading Quick Log..."})]})})})}),children:s.jsx(jr,{onOpenQuickLog:()=>S(!0)})})});case"reports":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📋 Loading Reports..."}),children:s.jsx(Sr,{})})});case"strategies":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📚 Loading Strategies..."}),children:s.jsx(Nr,{})})});case"seatMap":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"🪑 Loading Seat Map..."}),children:s.jsx(Cr,{})})});case"settings":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"⚙️ Loading Settings..."}),children:s.jsx(kr,{})})});case"strengthReports":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"🌟 Loading Strength Reports..."}),children:s.jsx(Rr,{})})});case"ocean":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"🌊 Loading Ocean..."}),children:s.jsx(Er,{})})});case"documents":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"📄 Loading AI Document Generator..."}),children:s.jsx(_r,{})})});case"referrals":return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice","LPBS","BSS"],children:s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"p-8 text-center text-xl",children:"🤝 Loading Referral System..."}),children:s.jsx(Or,{})})});default:return s.jsx(_,{allowedRoles:["teacher","school_admin","region_admin","CentralOffice"],children:s.jsx("div",{className:"max-w-4xl mx-auto",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8",children:[s.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Welcome to ClassTrack!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your comprehensive classroom behavior management platform."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"📊 Current Data Status"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`w-3 h-3 rounded-full ${i?.length>0?"bg-green-500":"bg-gray-300"}`}),s.jsxs("span",{children:["Students: ",i?.length||0]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`w-3 h-3 rounded-full ${l?.length>0?"bg-green-500":"bg-gray-300"}`}),s.jsxs("span",{children:["Behaviors: ",l?.length||0]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`w-3 h-3 rounded-full ${o?.length>0?"bg-green-500":"bg-gray-300"}`}),s.jsxs("span",{children:["ABC Incidents: ",o?.length||0]})]})]}),!i?.length&&!l?.length&&!o?.length&&s.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("p",{className:"text-yellow-800 text-sm",children:["⚠️ No data loaded. The app is using demo data for development.",!1]})})]}),s.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:U.map(k=>s.jsx(Nt,{feature:k,summary:m?.[k.id],summaryLoading:g,onClick:E},k.id))}),s.jsx("div",{className:"text-center",children:s.jsx("button",{onClick:()=>E("ai"),className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-lg font-semibold",children:"🚀 Explore AI Features"})})]})})})}})()}),!1,s.jsx(dr,{isOpen:f,onClose:()=>S(!1),onOpenEditModal:()=>B(!0),students:i.filter(k=>k.classId===c),selectedClassId:c}),s.jsx(ur,{isOpen:C,onClose:()=>B(!1),onSave:k=>{console.log("Behaviors updated:",k)}}),!1]})}const Ar=N.memo(Ir);function Pr(){return s.jsxs(s.Fragment,{children:[s.jsx(Ar,{}),s.jsx(Ys,{})]})}const Tr="https://your-project-id.supabase.co",Lr="your-anon-key-here",Mr=Ot(Tr,Lr,{auth:{persistSession:!0,autoRefreshToken:!0}}),J=Mr,Dr=u.createContext(null),Q="false".toLowerCase()==="true",Fr={user_id:"dev-user",role:"region_admin",school_id:"demo-school-001",display_name:"Dev Kevin",email:"kevin@example.com"},Ct="ct_dev_profile",ae=()=>{try{const e=localStorage.getItem(Ct);if(e)return JSON.parse(e)}catch{}return Fr},ge=e=>{try{localStorage.setItem(Ct,JSON.stringify(e))}catch{}};function Br({children:e}){const[t,r]=u.useState(null),[n,a]=u.useState(null),[i,l]=u.useState(!0);u.useEffect(()=>{if((async()=>{if(Q){const m=ae();r({id:m.user_id,email:m.email,devBypass:!0}),a(m),l(!1);return}const{data:{session:v}}=await J.auth.getSession();if(r(v?.user??null),v?.user){const{data:m}=await J.from("user_profiles").select("*").eq("user_id",v.user.id).single();a(m??null)}l(!1)})(),!Q){const{data:v}=J.auth.onAuthStateChange((m,x)=>{r(x?.user??null),x||a(null)});return()=>v.subscription.unsubscribe()}},[]);const p={user:t,profile:n,loading:i,signIn:(j,v)=>{if(Q){const m={...ae(),email:j};return ge(m),r({id:m.user_id,email:m.email,devBypass:!0}),a(m),Promise.resolve()}return J.auth.signInWithPassword({email:j,password:v})},signOut:()=>Q?(r(null),a(null),Promise.resolve()):J.auth.signOut(),devBypass:Q,setDevRole:j=>{Q&&a(v=>{const m={...v||ae(),role:j};return ge(m),m})},setDevSchool:j=>{Q&&a(v=>{const m={...v||ae(),school_id:j};return ge(m),m})},getToken:async()=>{if(Q)return null;const{data:{session:j}}=await J.auth.getSession();return j?.access_token||null}};return s.jsx(Dr.Provider,{value:p,children:e})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[SW] Registered successfully:",e.scope),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&console.log("[SW] New version available, please refresh")})})}).catch(e=>{console.log("[SW] Registration failed:",e)})});console.log("🚀 Starting ClassTrack application...");try{const e=document.getElementById("root");if(console.log("📍 Root element found:",e),!e)throw new Error("Root element not found");const t=At.createRoot(e);console.log("✅ React root created"),console.log("🔄 Attempting to render React components with router context...");const r=new _s;t.render(s.jsx(N.StrictMode,{children:s.jsx(rs,{children:s.jsx(Br,{children:s.jsx(Os,{client:r,children:s.jsx(Pr,{})})})})})),console.log("🎉 Application rendered successfully with router context")}catch(e){console.error("❌ Application startup failed:",e),document.body.innerHTML=`
    <div style="padding: 20px; font-family: Arial, sans-serif; color: red;">
      <h1>Application Error</h1>
      <p>${e.message}</p>
      <pre>${e.stack}</pre>
    </div>
  `}export{Vr as E,qr as L,qt as a,Wr as g,Ee as s,me as u};
